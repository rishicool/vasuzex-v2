
> vasuzex@2.0.5 test:unit /Users/rishi/Desktop/work/vasuzex-v2
> NODE_OPTIONS=--experimental-vm-modules npx jest tests/unit

npm warn Unknown env config "auto-install-peers". This will stop working in the next major version of npm.
npm warn Unknown env config "node-linker". This will stop working in the next major version of npm.
npm warn Unknown env config "shared-workspace-lockfile". This will stop working in the next major version of npm.
npm warn Unknown project config "node-linker". This will stop working in the next major version of npm.
npm warn Unknown project config "shared-workspace-lockfile". This will stop working in the next major version of npm.
npm warn Unknown project config "strict-peer-dependencies". This will stop working in the next major version of npm.
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.
watchman warning:  Recrawled this watch 3 times, most recently because:
MustScanSubDirs UserDroppedTo resolve, please review the information on
https://facebook.github.io/watchman/docs/troubleshooting.html#recrawl
To clear this warning, run:
`watchman watch-del '/Users/rishi/Desktop/work/vasuzex-v2' ; watchman watch-project '/Users/rishi/Desktop/work/vasuzex-v2'`

PASS tests/unit/route-patterns.test.cjs
  Route Patterns
    Media Server Routes
      ✓ should compile wildcard route pattern (8 ms)
      ✓ should match image paths correctly (1 ms)
      ✓ should handle array path params correctly
    API Routes
      ✓ should compile standard REST routes (38 ms)

(node:68786) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
(node:68789) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/Auth/Gate.test.js
  Gate
    Constructor
      ✓ should initialize with app and user resolver (61 ms)
    Ability Definition
      ✓ should define an ability (1 ms)
      ✓ should check if ability exists (21 ms)
      ✓ should check multiple abilities at once (3 ms)
      ✓ should return gate instance for chaining (1 ms)
    Resource Abilities
      ✓ should define resource abilities with default methods (2 ms)
      ✓ should define resource abilities with custom methods (1 ms)
    Policy Definition
      ✓ should define a policy for a model
      ✓ should define multiple policies
    Before and After Callbacks
      ✓ should register before callback (1 ms)
      ✓ should register after callback
      ✓ should execute before callbacks before ability check (2 ms)
      ✓ should execute after callbacks after ability check (1 ms)
      ✓ should allow after callback to override result (1 ms)
      ✓ should skip ability check if before callback returns non-null (1 ms)
      ✓ should continue if before callback returns null (18 ms)
    Ability Checks
      ✓ should check ability with allows()
      ✓ should check ability with denies() (1 ms)
      ✓ should pass arguments to ability callback
      ✓ should return false for undefined ability (1 ms)
      ✓ should resolve user from resolver
    Policy-based Authorization
      ✓ should check policy method (1 ms)
      ✓ should call policy before method if exists (1 ms)
      ✕ should find policy by model class (2 ms)
      ✓ should find policy by model name (1 ms)
    Authorization
      ✓ should authorize and return true (13 ms)
      ✓ should throw error when not authorized (2 ms)
    Any and Every
      ✓ should check any ability
      ✓ should return false if no abilities match
      ✓ should check every ability (1 ms)
      ✓ should return false if any ability fails
    For User
      ✓ should create gate for specific user (3 ms)
      ✓ should copy abilities to new gate (1 ms)
      ✓ should copy policies to new gate (3 ms)
      ✓ should copy callbacks to new gate (1 ms)
    Edge Cases
      ✓ should handle async ability callbacks (12 ms)
      ✓ should handle multiple arguments in ability
      ✓ should handle policy with string class path (1 ms)
      ✓ should handle policy instance directly (11 ms)
      ✓ should handle empty abilities array (1 ms)
      ✓ should handle null user from resolver
      ✓ should handle multiple before callbacks (1 ms)
      ✕ should handle multiple after callbacks (1 ms)
      ✕ should handle policy method with arguments (1 ms)
      ✓ should handle denies as opposite of allows (1 ms)

  ● Gate › Policy-based Authorization › should find policy by model class

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      304 |       const result = await gate.check('create', [new Post()]);
      305 |
    > 306 |       expect(result).toBe(true);
          |                      ^
      307 |     });
      308 |
      309 |     it('should find policy by model name', async () => {

      at Object.<anonymous> (tests/unit/Auth/Gate.test.js:306:22)

  ● Gate › Edge Cases › should handle multiple after callbacks

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      534 |
      535 |       expect(after1).toHaveBeenCalled();
    > 536 |       expect(after2).toHaveBeenCalled();
          |                      ^
      537 |       expect(after3).toHaveBeenCalled();
      538 |       expect(result).toBe(false);
      539 |     });

      at Object.<anonymous> (tests/unit/Auth/Gate.test.js:536:22)

  ● Gate › Edge Cases › should handle policy method with arguments

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: "New Title"

      556 |       const result = await gate.check('update', [post, data]);
      557 |
    > 558 |       expect(result).toBe(true);
          |                      ^
      559 |     });
      560 |
      561 |     it('should handle denies as opposite of allows', async () => {

      at Object.<anonymous> (tests/unit/Auth/Gate.test.js:558:22)

(node:68785) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/Auth/TokenGuard.test.js
  TokenGuard
    Constructor
      ✓ should initialize with default parameters (57 ms)
      ✓ should initialize with custom parameters (1 ms)
    User Retrieval
      ✓ should initialize with null user property (1 ms)
      ✓ should have user method defined
      ✕ should return null if no token (1 ms)
      ✕ should retrieve user by token from query (1 ms)
      ✕ should retrieve user by token from body (1 ms)
      ✕ should retrieve user by bearer token (1 ms)
      ✕ should retrieve user by basic auth password (1 ms)
      ✕ should hash token when hash option is enabled (1 ms)
      ✕ should prioritize query over body
      ✕ should prioritize bearer over basic auth
    Token Extraction
      ✓ should return null if no request set (1 ms)
      ✓ should extract token from query parameter (1 ms)
      ✓ should extract token from body
      ✓ should extract bearer token from header (1 ms)
      ✓ should extract basic auth password (1 ms)
      ✓ should handle malformed authorization header (1 ms)
      ✓ should handle missing authorization header (1 ms)
    Validation
      ✓ should validate valid credentials (2 ms)
      ✓ should reject invalid credentials (1 ms)
      ✓ should reject credentials without input key (1 ms)
      ✕ should hash token during validation when enabled
      ✓ should handle empty credentials
    User Management
      ✓ should set user
      ✕ should update cached user (1 ms)
    Request Management
      ✓ should set request (2 ms)
    Authentication Checks
      ✕ should return true when user is authenticated
      ✕ should return false when user is not authenticated
      ✕ should return false for guest when authenticated (1 ms)
      ✕ should return true for guest when not authenticated (1 ms)
    ID Retrieval
      ✕ should return user ID when authenticated (1 ms)
      ✕ should return null when not authenticated
    Edge Cases
      ✕ should handle request with null query (1 ms)
      ✕ should handle request with null body (3 ms)
      ✕ should handle request with null headers (4 ms)
      ✓ should handle empty bearer token (1 ms)
      ✓ should handle basic auth without colon (23 ms)
      ✕ should handle user without getAuthIdentifier method (1 ms)
      ✕ should handle multiple calls to user() with same result (1 ms)
      ✕ should handle custom input and storage keys (1 ms)

  ● TokenGuard › User Retrieval › should return null if no token

    TypeError: guard.user is not a function

      59 |       guard.request = { query: {}, body: {}, headers: {} };
      60 |
    > 61 |       const user = await guard.user();
         |                                ^
      62 |
      63 |       expect(user).toBeNull();
      64 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:61:32)

  ● TokenGuard › User Retrieval › should retrieve user by token from query

    TypeError: guard.user is not a function

      74 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      75 |
    > 76 |       const user = await guard.user();
         |                                ^
      77 |
      78 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      79 |         api_token: 'test-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:76:32)

  ● TokenGuard › User Retrieval › should retrieve user by token from body

    TypeError: guard.user is not a function

      92 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      93 |
    > 94 |       const user = await guard.user();
         |                                ^
      95 |
      96 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      97 |         api_token: 'body-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:94:32)

  ● TokenGuard › User Retrieval › should retrieve user by bearer token

    TypeError: guard.user is not a function

      110 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      111 |
    > 112 |       const user = await guard.user();
          |                                ^
      113 |
      114 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      115 |         api_token: 'bearer-token-123'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:112:32)

  ● TokenGuard › User Retrieval › should retrieve user by basic auth password

    TypeError: guard.user is not a function

      131 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      132 |
    > 133 |       const user = await guard.user();
          |                                ^
      134 |
      135 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      136 |         api_token: 'basic-password'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:133:32)

  ● TokenGuard › User Retrieval › should hash token when hash option is enabled

    TypeError: guard.user is not a function

      153 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      154 |
    > 155 |       const user = await guard.user();
          |                                ^
      156 |
      157 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      158 |         api_token: hashedToken

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:155:32)

  ● TokenGuard › User Retrieval › should prioritize query over body

    TypeError: guard.user is not a function

      171 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      172 |
    > 173 |       await guard.user();
          |                   ^
      174 |
      175 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      176 |         api_token: 'query-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:173:19)

  ● TokenGuard › User Retrieval › should prioritize bearer over basic auth

    TypeError: guard.user is not a function

      192 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      193 |
    > 194 |       await guard.user();
          |                   ^
      195 |
      196 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      197 |         api_token: 'bearer-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:194:19)

  ● TokenGuard › Validation › should hash token during validation when enabled

    TypeError: crypto.createHash is not a function

      82 |     const user = await this.provider.retrieveByCredentials({
      83 |       [this.storageKey]: this.hash 
    > 84 |         ? crypto.createHash('sha256').update(credentials[this.inputKey]).digest('hex')
         |                  ^
      85 |         : credentials[this.inputKey]
      86 |     });
      87 |

      at TokenGuard.validate (framework/Auth/Guards/TokenGuard.js:84:18)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:321:19)

  ● TokenGuard › User Management › should update cached user

    TypeError: guard.user is not a function

      347 |
      348 |       guard.setUser(user1);
    > 349 |       expect(await guard.user()).toBe(user1);
          |                          ^
      350 |
      351 |       guard.setUser(user2);
      352 |       expect(await guard.user()).toBe(user2);

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:349:26)

  ● TokenGuard › Authentication Checks › should return true when user is authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:376:34)

  ● TokenGuard › Authentication Checks › should return false when user is not authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:388:34)

  ● TokenGuard › Authentication Checks › should return false for guest when authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at TokenGuard.guest (framework/Auth/Guards/TokenGuard.js:118:25)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:402:34)

  ● TokenGuard › Authentication Checks › should return true for guest when not authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at TokenGuard.guest (framework/Auth/Guards/TokenGuard.js:118:25)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:414:34)

  ● TokenGuard › ID Retrieval › should return user ID when authenticated

    TypeError: this.user is not a function

      123 |    */
      124 |   async id() {
    > 125 |     const user = await this.user();
          |                             ^
      126 |     return user ? user.getAuthIdentifier() : null;
      127 |   }
      128 | }

      at TokenGuard.id (framework/Auth/Guards/TokenGuard.js:125:29)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:434:30)

  ● TokenGuard › ID Retrieval › should return null when not authenticated

    TypeError: this.user is not a function

      123 |    */
      124 |   async id() {
    > 125 |     const user = await this.user();
          |                             ^
      126 |     return user ? user.getAuthIdentifier() : null;
      127 |   }
      128 | }

      at TokenGuard.id (framework/Auth/Guards/TokenGuard.js:125:29)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:446:30)

  ● TokenGuard › Edge Cases › should handle request with null query

    TypeError: guard.user is not a function

      458 |       };
      459 |
    > 460 |       const user = await guard.user();
          |                                ^
      461 |
      462 |       expect(user).toBeNull();
      463 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:460:32)

  ● TokenGuard › Edge Cases › should handle request with null body

    TypeError: guard.user is not a function

      470 |       };
      471 |
    > 472 |       const user = await guard.user();
          |                                ^
      473 |
      474 |       expect(user).toBeNull();
      475 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:472:32)

  ● TokenGuard › Edge Cases › should handle request with null headers

    TypeError: guard.user is not a function

      482 |       };
      483 |
    > 484 |       const user = await guard.user();
          |                                ^
      485 |
      486 |       expect(user).toBeNull();
      487 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:484:32)

  ● TokenGuard › Edge Cases › should handle user without getAuthIdentifier method

    TypeError: this.user is not a function

      123 |    */
      124 |   async id() {
    > 125 |     const user = await this.user();
          |                             ^
      126 |     return user ? user.getAuthIdentifier() : null;
      127 |   }
      128 | }

      at TokenGuard.id (framework/Auth/Guards/TokenGuard.js:125:29)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:525:30)

  ● TokenGuard › Edge Cases › should handle multiple calls to user() with same result

    TypeError: guard.user is not a function

      537 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      538 |
    > 539 |       const user1 = await guard.user();
          |                                 ^
      540 |       const user2 = await guard.user();
      541 |       const user3 = await guard.user();
      542 |

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:539:33)

  ● TokenGuard › Edge Cases › should handle custom input and storage keys

    TypeError: guard.user is not a function

      559 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      560 |
    > 561 |       await guard.user();
          |                   ^
      562 |
      563 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      564 |         stored_token: 'my-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:561:19)

(node:68787) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/Auth/ModelUserProvider.test.js
  ModelUserProvider
    Constructor
      ✓ should initialize with hasher and model path (9 ms)
    Retrieve By ID
      ✕ should retrieve user by id (1 ms)
      ✕ should return null for non-existent user (1 ms)
      ✕ should use getAuthIdentifierName if available (2 ms)
    Retrieve By Token
      ✕ should retrieve user by id and token (2 ms)
      ✕ should return null if user not found (1 ms)
      ✕ should return null if token does not match
      ✕ should handle user without getRememberToken method (1 ms)
    Update Remember Token
      ✓ should update remember token using setRememberToken (2 ms)
      ✓ should update remember token directly if no method (1 ms)
    Retrieve By Credentials
      ✓ should retrieve user by email (1 ms)
      ✓ should ignore password field in query (3 ms)
      ✓ should return null for empty credentials (1 ms)
      ✓ should return null for null credentials (1 ms)
      ✓ should handle array values with whereIn (1 ms)
      ✓ should handle multiple credentials
      ✓ should return null if only password provided (1 ms)
    Validate Credentials
      ✓ should validate correct credentials (1 ms)
      ✓ should reject incorrect credentials
      ✓ should use getAuthPassword if available (1 ms)
      ✓ should fallback to password property
    Model Management
      ✓ should create model instance
      ✓ should get model path (1 ms)
      ✓ should set model path
    Hasher Management
      ✓ should get hasher (1 ms)
      ✓ should set hasher
    Edge Cases
      ✕ should handle model without getAuthIdentifierName (20 ms)
      ✓ should handle credentials with special characters (1 ms)
      ✓ should handle empty array in credentials (1 ms)
      ✓ should handle undefined password in credentials (1 ms)
      ✓ should handle null password in validation (1 ms)
      ✕ should handle user with null remember_token
      ✓ should handle credentials with password in field name
      ✓ should handle model loading without default export
      ✕ should handle async model methods (1 ms)
      ✓ should chain method calls for fluent interface (1 ms)

  ● ModelUserProvider › Retrieve By ID › should retrieve user by id

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:132:35)

  ● ModelUserProvider › Retrieve By ID › should return null for non-existent user

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:140:35)

  ● ModelUserProvider › Retrieve By ID › should use getAuthIdentifierName if available

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:146:35)

  ● ModelUserProvider › Retrieve By Token › should retrieve user by id and token

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:154:35)

  ● ModelUserProvider › Retrieve By Token › should return null if user not found

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:162:35)

  ● ModelUserProvider › Retrieve By Token › should return null if token does not match

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:168:35)

  ● ModelUserProvider › Retrieve By Token › should handle user without getRememberToken method

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:180:35)

  ● ModelUserProvider › Edge Cases › should handle model without getAuthIdentifierName

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:426:35)

  ● ModelUserProvider › Edge Cases › should handle user with null remember_token

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:519:35)

  ● ModelUserProvider › Edge Cases › should handle async model methods

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:575:35)

(node:68784) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/client-config-generator.test.js
  ClientConfigGenerator
    generate()
      ✕ should generate basic configuration (62 ms)
      ✕ should include app configuration
      ✕ should include API configuration (1 ms)
      ✕ should include auth configuration without secrets (1 ms)
      ✕ should include feature flags (1 ms)
      ✕ should include upload configuration (1 ms)
      ✕ should include branding configuration
      ✕ should include formatting configuration
      ✕ should merge custom configuration
      ✕ should apply overrides
      ✕ should expose additional config keys
      ✕ should exclude specified keys
      ✕ should not expose excluded keys even if in expose list
    generatePublic()
      ✕ should generate minimal public configuration (1 ms)
      ✕ should include only public fields
      ✕ should include minimal auth info
    generateForUser()
      ✕ should generate user-specific configuration
      ✕ should include base config with user config
    Helper methods
      _deepMerge()
        ✕ should merge nested objects (1 ms)
        ✕ should override primitive values
      _setNestedValue()
        ✕ should set nested value using dot notation
        ✕ should override existing values
      _deleteNestedValue()
        ✕ should delete nested value using dot notation
        ✕ should handle non-existent paths gracefully (1 ms)
      _isObject()
        ✕ should return true for plain objects
        ✕ should return false for arrays
        ✕ should return false for primitives

  ● ClientConfigGenerator › generate() › should generate basic configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should generate basic configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include app configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include app configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include API configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include API configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include auth configuration without secrets

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include auth configuration without secrets

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include feature flags

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include feature flags

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include upload configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include upload configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include branding configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include branding configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include formatting configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include formatting configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should merge custom configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should merge custom configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should apply overrides

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should apply overrides

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should expose additional config keys

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should expose additional config keys

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should exclude specified keys

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should exclude specified keys

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should not expose excluded keys even if in expose list

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should not expose excluded keys even if in expose list

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generatePublic() › should generate minimal public configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generatePublic() › should generate minimal public configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generatePublic() › should include only public fields

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generatePublic() › should include only public fields

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generatePublic() › should include minimal auth info

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generatePublic() › should include minimal auth info

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generateForUser() › should generate user-specific configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generateForUser() › should generate user-specific configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generateForUser() › should include base config with user config

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generateForUser() › should include base config with user config

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should merge nested objects

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should merge nested objects

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should override primitive values

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should override primitive values

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should set nested value using dot notation

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should set nested value using dot notation

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should override existing values

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should override existing values

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should delete nested value using dot notation

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should delete nested value using dot notation

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should handle non-existent paths gracefully

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should handle non-existent paths gracefully

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return true for plain objects

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return true for plain objects

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for arrays

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for arrays

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for primitives

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for primitives

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 2 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

PASS tests/unit/Foundation/Container.test.js
  Container
    Constructor
      ✓ should initialize with empty collections (4 ms)
    bind()
      ✓ should bind a class to the container (1 ms)
      ✓ should bind a factory function to the container (1 ms)
      ✓ should not mark as singleton by default (1 ms)
      ✓ should mark as singleton when third parameter is true
      ✓ should allow rebinding (1 ms)
    singleton()
      ✓ should bind as singleton (26 ms)
      ✓ should resolve to same instance on multiple makes (1 ms)
    instance()
      ✓ should store an existing instance
      ✓ should return the same instance when resolved (1 ms)
    alias()
      ✓ should create an alias for a binding
      ✓ should resolve through alias
      ✓ should allow multiple aliases for same binding (1 ms)
    make()
      ✓ should resolve a bound class
      ✓ should resolve a factory class (1 ms)
      ✓ should return new instance each time for non-singleton
      ✓ should cache and return same instance for singleton
      ✓ should return existing instance first if available (1 ms)
      ✓ should throw error for missing binding (3 ms)
      ✓ should resolve through alias
      ✓ should handle non-constructor concrete bindings (1 ms)
    has()
      ✓ should return true for existing binding (1 ms)
      ✓ should return true for existing instance
      ✓ should return false for non-existent binding
      ✓ should return true for aliased binding (1 ms)
      ✓ should work with both bindings and instances
    forget()
      ✓ should remove a binding
      ✓ should remove an instance
      ✓ should remove singleton marker
      ✓ should resolve through alias when forgetting
      ✓ should not throw error when forgetting non-existent binding (1 ms)
    flush()
      ✓ should clear all bindings (1 ms)
      ✓ should clear all instances
      ✓ should clear all singletons (1 ms)
      ✓ should clear all aliases
      ✓ should clear all collections in one call
    Integration scenarios
      ✓ should support complex dependency resolution (1 ms)
      ✓ should handle circular dependencies gracefully
      ✓ should support factory-based resolution with unique instances

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 2 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: production)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.error
    ❌ Failed to load configs from app_configs: Database error

      61 |       console.log(`✅ Loaded ${configs.length} configs from ${this.tableName}`);
      62 |     } catch (error) {
    > 63 |       console.error(`❌ Failed to load configs from ${this.tableName}:`, error.message);
         |               ^
      64 |       throw error;
      65 |     }
      66 |   }

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:63:15)
      at ConfigService.init (framework/Services/Config/ConfigService.js:36:5)
      at Object.<anonymous> (tests/unit/Services/Config/ConfigService.test.js:146:7)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

PASS tests/unit/Support/Helpers/ResponseHelper.test.js
  ResponseHelper
    success
      ✓ should return success response with data (9 ms)
      ✓ should include timestamp (1 ms)
      ✓ should handle null data (1 ms)
    error
      ✓ should return error response (1 ms)
      ✓ should handle error without details
    created
      ✓ should return 201 created response (1 ms)
    noContent
      ✓ should return 204 no content
    badRequest
      ✓ should return 400 bad request (1 ms)
    unauthorized
      ✓ should return 401 unauthorized (1 ms)
      ✓ should use default message
    forbidden
      ✓ should return 403 forbidden (1 ms)
      ✓ should use default message
    notFound
      ✓ should return 404 not found (1 ms)
      ✓ should use default message
    conflict
      ✓ should return 409 conflict (1 ms)
    validationError
      ✓ should return 422 validation error (1 ms)
      ✓ should use default message
    serverError
      ✓ should return 500 server error (1 ms)
      ✓ should use default message
    paginated
      ✓ should return paginated response (1 ms)
    custom
      ✓ should return custom response
    ResponseHelper class
      ✓ should provide static methods
      ✓ should have all response methods (1 ms)

PASS tests/unit/Foundation/Application.test.js
  Application
    Constructor
      ✓ should initialize with Container inheritance (5 ms)
      ✓ should create Express instance (15 ms)
      ✓ should initialize with empty providers array (2 ms)
      ✓ should initialize with booted and bootstrapped flags as false (2 ms)
      ✓ should use provided rootDir (1 ms)
      ✓ should set rootDir to null when not provided (1 ms)
      ✓ should bind app instance to container (1 ms)
      ✓ should bind express instance to container (1 ms)
      ✓ should set Facade application
    detectRootDir()
      ✓ should return a valid path (2 ms)
      ✓ should resolve to parent directory of framework
    bootstrap()
      ✓ should set bootstrapped flag to true (43 ms)
      ✓ should not bootstrap twice (1 ms)
      ✓ should use provided rootDir (1 ms)
      ✓ should detect rootDir when not provided (1 ms)
      ✓ should bind config to container after bootstrap (2 ms)
    config()
      ✓ should throw error when config not bound (5 ms)
      ✓ should return config value or default when config returns value (7 ms)
      ✓ should retrieve config value from bound config (3 ms)
      ✓ should support nested config keys (1 ms)
    register()
      ✓ should register a service provider (1 ms)
      ✓ should pass app instance to provider constructor (1 ms)
      ✓ should bind provider options when provided
      ✓ should not bind options when not provided (1 ms)
      ✓ should allow method chaining (1 ms)
      ✓ should register multiple providers
    boot()
      ✓ should set booted flag to true (2 ms)
      ✓ should not boot twice (12 ms)
      ✓ should bootstrap application before booting (2 ms)
      ✓ should call register on all providers before boot (1 ms)
      ✓ should call register and boot on all providers (2 ms)
    getExpress()
      ✓ should return express instance (1 ms)
      ✓ should return same instance across multiple calls
    use()
      ✓ should add middleware to express (3 ms)
      ✓ should allow method chaining
      ✓ should support multiple arguments (1 ms)
    listen()
      ✓ should boot application before starting server (2 ms)
      ✓ should start express server on specified port (2 ms)
      ✓ should log server start message (1 ms)
      ✓ should call callback if provided (2 ms)
      ✓ should skip double boot when already booted (1 ms)
    handleError()
      ✓ should add error handler to express (1 ms)
      ✓ should allow method chaining (1 ms)
    Integration scenarios
      ✓ should support full application lifecycle (8 ms)
      ✓ should support fluent interface (1 ms)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 3 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

PASS tests/unit/Logging/LogDrivers.test.js
  Logging Drivers
    ConsoleLogger
      ✓ should log at different levels (3 ms)
      ✓ should support colored output
      ✓ should format timestamps
      ✓ should pretty-print context (1 ms)
    FileLogger
      ✓ should write logs asynchronously (1 ms)
      ✓ should rotate logs daily
      ✓ should clean old logs (1 ms)
      ✓ should generate date-based filenames
      ✓ should support rotation strategies (1 ms)
    SyslogLogger
      ✓ should log to syslog (11 ms)
      ✓ should calculate syslog priority
      ✓ should support RFC 5424 format (1 ms)
      ✓ should support facilities
    LogManager
      ✓ should create console driver (1 ms)
      ✓ should create file driver (1 ms)
      ✓ should create syslog driver
      ✓ should support multiple channels (1 ms)
      ✓ should support stack channels

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 0 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: production)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: development)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 4 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 1 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 2 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

  console.log
    📦 Loading configs from app_configs (env: test)

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:45:15)

  console.log
    ✅ Loaded 6 configs from app_configs

      at ConfigService._loadConfigs (framework/Services/Config/ConfigService.js:61:15)

PASS tests/unit/Services/Config/ConfigService.test.js
  ConfigService
    Constructor
      ✓ should initialize with default options (4 ms)
      ✓ should initialize with custom options (1 ms)
      ✓ should start with empty cache (3 ms)
    init()
      ✓ should initialize with database and load configs (55 ms)
      ✓ should load configs during initialization (27 ms)
    _loadConfigs()
      ✓ should load all active configs for current environment (3 ms)
      ✓ should filter by specific environment (3 ms)
      ✓ should update lastLoadTime after loading (35 ms)
      ✓ should handle database errors gracefully (12 ms)
    _buildNestedObject()
      ✓ should convert flat key-value pairs to nested object (1 ms)
      ✓ should parse boolean string values (1 ms)
      ✓ should parse numeric string values (1 ms)
      ✓ should keep string values as strings
      ✓ should handle deep nesting (1 ms)
      ✓ should handle empty configs array
    _getNestedValue()
      ✓ should retrieve nested values using dot notation (1 ms)
      ✓ should return undefined for non-existent paths
      ✓ should handle single-level keys (1 ms)
    get()
      ✓ should retrieve cached config values (3 ms)
      ✓ should return fallback for non-existent keys (2 ms)
      ✓ should return null as default fallback (4 ms)
      ✓ should trigger reload if cache expired but return cached value (257 ms)
      ✓ should not reload if cache still valid (1 ms)
    getAll()
      ✓ should return all cached configs (2 ms)
      ✓ should return empty object when no configs loaded (1 ms)
    reload()
      ✓ should force reload from database (3 ms)
      ✓ should update lastLoadTime after reload (14 ms)
    shouldReload()
      ✓ should return true when cache expired (153 ms)
      ✓ should return false when cache still valid (2 ms)
      ✓ should return falsy when never loaded (1 ms)
    clear()
      ✓ should clear cache and reset state (1 ms)
    Integration Scenarios
      ✓ should handle multiple environments correctly (3 ms)
      ✓ should handle complex nested configuration (2 ms)
      ✓ should trigger auto-reload on cache expiry during get (205 ms)
      ✓ should filter inactive configs (2 ms)
      ✓ should handle data type conversions correctly (2 ms)

PASS tests/unit/Foundation/ServiceProvider.test.js
  ServiceProvider
    Constructor
      ✓ should store app instance (14 ms)
      ✓ should work with any application instance (1 ms)
    register()
      ✓ should be a no-op by default (1 ms)
      ✓ should return undefined by default
      ✓ should be overridable in subclass
      ✓ should have access to app in subclass register (2 ms)
    boot()
      ✓ should be a no-op by default (1 ms)
      ✓ should return undefined by default (1 ms)
      ✓ should be overridable in subclass (1 ms)
      ✓ should have access to app in subclass boot (1 ms)
    Subclass patterns
      ✓ should support register and boot lifecycle (1 ms)
      ✓ should support binding services in register (1 ms)
      ✓ should support bootstrapping in boot phase (1 ms)
      ✓ should support async register (4 ms)
      ✓ should support async boot (4 ms)
    Integration with Application
      ✓ should work with Application.register() (1 ms)
      ✓ should execute register phase before boot in Application.boot() (16 ms)
      ✓ should receive options when registered with Application (2 ms)
      ✓ should support multiple providers with dependencies (3 ms)
    Real-world provider examples
      ✓ should implement a mail provider pattern (2 ms)
      ✓ should implement a validation provider pattern (31 ms)

(node:68788) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/unit/Database/models/User.test.js
  User Model
    Configuration
      ✓ should have correct table name (1279 ms)
      ✓ should have correct primary key
      ✓ should have timestamps enabled (1 ms)
      ✓ should have soft deletes enabled
      ✓ should have fillable fields defined (2 ms)
      ✓ should have hidden fields defined
      ✓ should have casts defined (1 ms)
    Static Properties
      ✓ should not include password in fillable fields (26 ms)
      ✓ should hide sensitive fields (2 ms)
      ✓ should cast datetime fields (1 ms)
    Methods
      ✓ should have setPasswordAttribute method (2 ms)
      ✓ should have getNameAttribute method (1 ms)
      ✓ should have getFullNameAttribute method
      ✓ should have isAdmin method
      ✓ should have verifyPassword method (1 ms)
    getNameAttribute
      ✓ should capitalize first letter of name
      ✓ should handle already capitalized names (1 ms)
      ✓ should handle empty or null values
      ✓ should handle single character names (1 ms)
    Model Instance
      ✓ should create instance with new keyword (1 ms)
      ✓ should inherit from Model base class
    Field Definitions
      ✓ should allow setting fillable fields (1 ms)
      ✓ should have standard user fields in fillable (1 ms)
      ✓ should have role field for authorization
      ✓ should have avatar field for profile images (1 ms)
    Security
      ✓ should hide password from serialization
      ✓ should hide remember_token from serialization
      ✓ should not expose sensitive fields (1 ms)

PASS tests/unit/Database/models/index.test.js
  Database Models Index
    Exports
      ✓ should export Post model (19 ms)
      ✓ should export Comment model (4 ms)
      ✓ should export Task model (1 ms)
      ✓ should export User model (1 ms)
      ✓ should have all expected models (3 ms)
      ✓ should export exactly 4 models (1 ms)
    Model Classes
      ✓ should have User class with proper structure (3 ms)
      ✓ should have Post class with proper structure (1 ms)
      ✓ should have Comment class with proper structure (1 ms)
      ✓ should have Task class with proper structure (1 ms)

PASS tests/unit/Http/Middleware/RequestResponseMiddleware.test.js
  RequestResponseMiddleware
    Middleware Function
      ✓ should be a function (3 ms)
      ✓ should call next() (6 ms)
      ✓ should not throw errors (7 ms)
    req.request() Wrapper
      ✓ should add request() method to req (2 ms)
      ✓ should return Request instance (1 ms)
      ✓ should wrap the Express req object
    req.response() Wrapper
      ✓ should add response() method to req (2 ms)
      ✓ should return Response instance (1 ms)
      ✓ should wrap the Express res object (1 ms)
    res.success() Helper
      ✓ should add success() method to res
      ✓ should send success response with data (2 ms)
      ✓ should use custom status code
    res.error() Helper
      ✓ should add error() method to res
      ✓ should send error response
      ✓ should use default status 400 (1 ms)
    res.created() Helper
      ✓ should add created() method to res
      ✓ should send 201 response (4 ms)
    res.validationError() Helper
      ✓ should add validationError() method to res (2 ms)
      ✓ should send 422 validation error response
    res.notFound() Helper
      ✓ should add notFound() method to res
      ✓ should send 404 response (1 ms)
      ✓ should use default message
    res.unauthorized() Helper
      ✓ should add unauthorized() method to res (1 ms)
      ✓ should send 401 response
      ✓ should use default message (1 ms)
    res.forbidden() Helper
      ✓ should add forbidden() method to res
      ✓ should send 403 response (1 ms)
      ✓ should use default message
    Integration
      ✓ should add all helpers in single middleware call (4 ms)
      ✓ should work with chained middleware (2 ms)

PASS tests/unit/Http/Middleware/Authenticate.test.js
  Authenticate Middleware
    Authenticate class
      ✓ should create middleware instance (4 ms)
      ✓ should create with options (5 ms)
      ✓ should authenticate user successfully (2 ms)
      ✓ should fail when user not authenticated (1 ms)
      ✓ should use custom error message (1 ms)
      ✓ should use default guard when not specified
      ✓ should handle authentication errors (1 ms)
      ✓ should fail when Auth service not available (1 ms)
      ✓ should use global Auth if not in app.locals
    authenticate factory
      ✓ should create middleware function
      ✓ should authenticate user (1 ms)
      ✓ should work with default guard
      ✓ should pass options to middleware
    optionalAuth factory
      ✓ should set user when authenticated (1 ms)
      ✓ should not fail when user not authenticated
      ✓ should not fail when Auth service not available (1 ms)
      ✓ should not fail on authentication errors
      ✓ should use global Auth if available (1 ms)
    integration tests
      ✓ should work in middleware chain
      ✓ should stop chain on authentication failure (1 ms)

PASS tests/unit/Foundation/BaseApp.test.js
  BaseApp
    Constructor
      ✓ should initialize with default options (25 ms)
      ✓ should initialize with custom options using serviceName (1 ms)
      ✓ should initialize with custom options using appName (2 ms)
      ✓ should prioritize serviceName over appName for serviceName property (1 ms)
      ✓ should inherit from Application and have express instance (1 ms)
      ✓ should use rootDir option when provided (1 ms)
      ✓ should use projectRoot as fallback for rootDir
    setAppInfo()
      ✓ should set app name and type
      ✓ should allow method chaining (26 ms)
      ✓ should update existing app info
    build()
      ✓ should call setupCustomMiddleware on first build (1 ms)
      ✓ should call setupRoutes on first build (1 ms)
      ✓ should not call setupCustomMiddleware twice (1 ms)
      ✓ should not call setupRoutes twice
      ✓ should return express instance (1 ms)
      ✓ should setup error handlers when provided (3 ms)
      ✓ should handle only notFoundHandler when errorHandler not provided (1 ms)
      ✓ should handle only errorHandler when notFoundHandler not provided
      ✓ should not setup error handlers when getErrorHandlers returns null (1 ms)
      ✓ should execute in correct order: middleware -> routes -> error handlers (7 ms)
    registerRoute()
      ✓ should register route with express
      ✓ should allow multiple route registrations (1 ms)
    setupCustomMiddleware()
      ✓ should be a no-op by default (1 ms)
      ✓ should be overridable in subclass (1 ms)
    setupRoutes()
      ✓ should be a no-op by default (1 ms)
      ✓ should be overridable in subclass
    getErrorHandlers()
      ✓ should return null by default (1 ms)
      ✓ should be overridable in subclass (2 ms)
    getExpress()
      ✓ should return express instance (1 ms)
      ✓ should return same instance across multiple calls (1 ms)
    boot()
      ✓ should set booted flag to true
      ✓ should not boot twice (4 ms)
      ✓ should call boot on all registered providers (9 ms)
      ✓ should handle providers without boot method (1 ms)
      ✓ should boot providers in order (1 ms)
    Integration scenarios
      ✓ should build and setup complete app with middleware, routes, and error handlers (1 ms)
      ✓ should support chaining setAppInfo and build (1 ms)
      ✓ should maintain state correctly after multiple builds (1 ms)

PASS tests/unit/Security/SecurityMiddleware.test.js
  SecurityMiddleware
    Helmet Integration
      ✓ should apply helmet security headers (3 ms)
      ✓ should enable CSP by default
      ✓ should configure HSTS headers (1 ms)
    CORS Configuration
      ✓ should enable CORS when configured (1 ms)
      ✓ should handle dynamic origin validation
      ✓ should support wildcard origin
    CSRF Protection
      ✓ should enable CSRF protection (10 ms)
      ✓ should configure CSRF cookie options
      ✓ should use csrf-csrf package (6 ms)
    Middleware Integration
      ✓ should export SecurityMiddleware class
      ✓ should integrate with BaseApp

PASS tests/unit/Database/models/Post.test.js
  Post Model
    Configuration
      ✓ should have correct table name (1369 ms)
      ✓ should have correct primary key (1 ms)
      ✓ should have timestamps enabled
      ✓ should have fillable fields defined (1 ms)
      ✓ should have casts defined (1 ms)
    Fillable Fields
      ✓ should include title field (1 ms)
      ✓ should include content field
      ✓ should include author field (1 ms)
      ✓ should include status field (1 ms)
      ✓ should include published_at field
      ✓ should have exactly 5 fillable fields (2 ms)
    Casts
      ✓ should cast published_at to datetime (1 ms)
    Relationships
      ✓ should have comments relationship method (2 ms)
    Query Scopes
      ✓ should have scopePublished static method (1 ms)
      ✓ should have scopeDraft static method
      ✓ should have scopeRecent static method
    Accessors
      ✓ should have getExcerptAttribute method (1 ms)
      ✓ should return excerpt with ellipsis for long content (1 ms)
      ✓ should return full content without ellipsis for short content
      ✓ should return exactly 100 characters plus ellipsis for long content
      ✓ should handle empty or null content (1 ms)
    Model Instance
      ✓ should create instance with new keyword
      ✓ should have attributes property (1 ms)
    Status Management
      ✓ should support published status in fillable
      ✓ should have scope for published posts
      ✓ should have scope for draft posts (1 ms)

(node:68783) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/unit/import-aliases.test.js
  Unit: Import Alias Patterns
    #framework/* alias pattern
      ✓ should resolve to correct framework path (62 ms)
      ✓ should support nested paths (494 ms)
      ✓ should work with deep nesting (2 ms)
      ✓ should import different service types (45 ms)
      ✕ should fail without .js extension (11 ms)
    #models/* alias pattern
      ✓ should import individual model with .js (1115 ms)
      ✓ should import all models from index (21 ms)
      ✓ should import multiple models individually (1 ms)
      ✓ should cache model imports (same reference) (1 ms)
      ✕ models should extend base Model class (2 ms)
    #database alias pattern
      ✓ should import database utilities (2 ms)
      ✓ should provide database connection factory
    #config alias pattern
      ✓ should import config module (1 ms)
      ✓ should import specific config utilities (1 ms)
    vasuzex/* alias pattern (via jest)
      ✓ should import main framework exports (943 ms)
      ✕ should import from subpaths (1 ms)
      ✕ should import support utilities (2 ms)
      ✕ should import facades individually (1 ms)
    Mixed import patterns
      ✓ should combine vasuzex and #models imports (1 ms)
      ✓ should combine #framework and #models imports (1 ms)
      ✓ should combine all alias types
    Destructuring patterns
      ✓ should support named imports (1 ms)
      ✓ should support default + named imports
      ✓ should support namespace imports (1 ms)
      ✓ should support aliased imports (1 ms)
    Dynamic imports
      ✓ should support dynamic model imports
      ✓ should support conditional imports (1 ms)
      ✕ should support lazy loading
    Error handling
      ✓ should throw on invalid path (2 ms)
      ✕ should throw on missing file extension for #framework
      ✕ should handle import errors gracefully (3 ms)
    Import caching and performance
      ✓ should cache imports (same module reference)
      ✓ should cache model imports (1 ms)
      ✓ should handle multiple concurrent imports
      ✓ should complete imports quickly
    Real-world usage patterns
      ✓ Provider pattern (framework internal)
      ✓ Controller pattern (user application)
      ✓ Middleware pattern (using facades)
      ✓ Service pattern (combining imports) (1 ms)
    Type consistency
      ✓ should maintain consistent types across imports
      ✕ should maintain class inheritance (1 ms)
      ✕ should maintain prototype chain

  ● Unit: Import Alias Patterns › #framework/* alias pattern › should fail without .js extension

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      43 |
      44 |     test('should fail without .js extension', async () => {
    > 45 |       await expect(async () => {
         |             ^
      46 |         await import('#framework/Services/Cache/CacheManager');
      47 |       }).rejects.toThrow();
      48 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:45:13)

  ● Unit: Import Alias Patterns › #models/* alias pattern › models should extend base Model class

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      87 |
      88 |     test('models should extend base Model class', async () => {
    > 89 |       const Model = await import('vasuzex/Database/Model.js');
         |                     ^
      90 |       const { User } = await import('#models/User.js');
      91 |       
      92 |       expect(User.prototype).toBeInstanceOf(Model.default);

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:89:21)

  ● Unit: Import Alias Patterns › vasuzex/* alias pattern (via jest) › should import from subpaths

    Cannot find module 'vasuzex/Foundation/Application.js' from 'tests/unit/import-aliases.test.js'

      146 |
      147 |     test('should import from subpaths', async () => {
    > 148 |       const { Application } = await import('vasuzex/Foundation/Application.js');
          |                               ^
      149 |       const Model = await import('vasuzex/Database/Model.js');
      150 |       const { Collection } = await import('vasuzex/Support/Collection.js');
      151 |       

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:148:31)

  ● Unit: Import Alias Patterns › vasuzex/* alias pattern (via jest) › should import support utilities

    Cannot find module 'vasuzex/Support/Str.js' from 'tests/unit/import-aliases.test.js'

      156 |
      157 |     test('should import support utilities', async () => {
    > 158 |       const { Str } = await import('vasuzex/Support/Str.js');
          |                       ^
      159 |       const { Arr } = await import('vasuzex/Support/Arr.js');
      160 |       
      161 |       expect(typeof Str.slug).toBe('function');

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:158:23)

  ● Unit: Import Alias Patterns › vasuzex/* alias pattern (via jest) › should import facades individually

    Cannot find module 'vasuzex/Support/Facades/DB.js' from 'tests/unit/import-aliases.test.js'

      166 |
      167 |     test('should import facades individually', async () => {
    > 168 |       const { DB } = await import('vasuzex/Support/Facades/DB.js');
          |                      ^
      169 |       const { Cache } = await import('vasuzex/Support/Facades/Cache.js');
      170 |       const { Auth } = await import('vasuzex/Support/Facades/Auth.js');
      171 |       

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:168:22)

  ● Unit: Import Alias Patterns › Dynamic imports › should support lazy loading

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      265 |       
      266 |       const loadModel = async () => {
    > 267 |         Model = await import('vasuzex/Database/Model.js');
          |                 ^
      268 |       };
      269 |       
      270 |       await loadModel();

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at loadModel (tests/unit/import-aliases.test.js:267:17)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:270:7)

  ● Unit: Import Alias Patterns › Error handling › should throw on missing file extension for #framework

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      281 |
      282 |     test('should throw on missing file extension for #framework', async () => {
    > 283 |       await expect(async () => {
          |             ^
      284 |         await import('#framework/Services/Cache/CacheManager');
      285 |       }).rejects.toThrow();
      286 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:283:13)

  ● Unit: Import Alias Patterns › Error handling › should handle import errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "ERR_MODULE_NOT_FOUND"
    Received: "MODULE_NOT_FOUND"

      291 |       } catch (error) {
      292 |         expect(error).toBeDefined();
    > 293 |         expect(error.code).toBe('ERR_MODULE_NOT_FOUND');
          |                            ^
      294 |       }
      295 |     });
      296 |   });

      at Object.<anonymous> (tests/unit/import-aliases.test.js:293:28)

  ● Unit: Import Alias Patterns › Type consistency › should maintain class inheritance

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      420 |
      421 |     test('should maintain class inheritance', async () => {
    > 422 |       const Model = await import('vasuzex/Database/Model.js');
          |                     ^
      423 |       const { User } = await import('#models/User.js');
      424 |       
      425 |       const user = new User();

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:422:21)

  ● Unit: Import Alias Patterns › Type consistency › should maintain prototype chain

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      429 |
      430 |     test('should maintain prototype chain', async () => {
    > 431 |       const Model = await import('vasuzex/Database/Model.js');
          |                     ^
      432 |       const { Post } = await import('#models/Post.js');
      433 |       
      434 |       expect(Object.getPrototypeOf(Post)).toBe(Model.default);

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:431:21)

PASS tests/unit/Database/Model.test.js
  Model
    Constructor and Boot
      ✓ creates instance with empty attributes (3 ms)
      ✓ creates instance with initial attributes
      ✓ boots model only once
      ✓ syncs original attributes on construction (22 ms)
    Fill and Fillable
      ✓ fill() sets fillable attributes (2 ms)
      ✓ fill() ignores non-fillable attributes (1 ms)
      ✓ forceFill() bypasses fillable restrictions (1 ms)
      ✓ isFillable() returns true for fillable attributes (1 ms)
      ✓ isFillable() returns false for non-fillable attributes (1 ms)
      ✓ guarded model allows all except guarded (1 ms)
      ✓ fill() returns this for chaining
    Attributes
      ✓ setAttribute() stores attribute value
      ✓ setAttribute() marks model as dirty (1 ms)
      ✓ getAttribute() retrieves attribute value
      ✓ getAttribute() returns undefined for missing attribute
      ✓ setAttribute() with mutator calls mutator method (1 ms)
      ✓ getAttribute() with accessor calls accessor method
      ✓ studly() converts snake_case to StudlyCase
    Casting
      ✓ castAttribute() casts to integer (1 ms)
      ✓ castAttribute() casts to boolean
      ✓ castAttribute() casts to JSON (1 ms)
      ✓ castAttribute() handles array casting (1 ms)
      ✓ castAttribute() casts to date
      ✓ castAttribute() returns null for null values (5 ms)
      ✓ castAttributeForStorage() serializes JSON
      ✓ castAttributeForStorage() handles dates (1 ms)
      ✓ getAttribute() applies casting automatically
    Dirty Tracking
      ✓ syncOriginal() copies current attributes to original
      ✓ isDirty() returns true when attributes changed
      ✓ isDirty() with specific attribute (2 ms)
      ✓ isDirty() with array of attributes
      ✓ getDirty() returns only changed attributes (1 ms)
      ✓ getOriginal() returns all original values
      ✓ getOriginal() with key returns specific original value
    Primary Key
      ✓ getKey() returns primary key value (1 ms)
      ✓ setKey() sets primary key value
      ✓ uses custom primary key if defined
    Serialization
      ✓ toArray() converts to plain object
      ✓ toArray() respects hidden attributes
      ✓ toArray() respects visible attributes (1 ms)
      ✓ toArray() includes appended attributes
      ✓ toJSON() returns same as toArray() (1 ms)
      ✓ toArray() handles relations
    Timestamps
      ✓ updateTimestamps() sets created_at on new model (1 ms)
      ✓ updateTimestamps() sets only updated_at on existing model
      ✓ updateTimestamps() respects custom timestamp columns
    Soft Deletes
      ✓ trashed() returns false for non-deleted model (1 ms)
      ✓ trashed() returns true for soft deleted model (2 ms)
      ✓ trashed() returns false if soft deletes disabled (1 ms)
      ✓ trashed() uses custom deletedAt column
    Event Dispatcher
      ✓ fireModelEvent() returns true when no dispatcher set
      ✓ setEventDispatcher() sets dispatcher (1 ms)
      ✓ fireModelEvent() calls dispatcher until method (2 ms)
      ✓ fireModelEvent() with halt=false uses dispatch
    Static Factory Methods
      ✓ newFromBuilder() creates instance from database result (1 ms)
      ✓ newFromBuilder() bypasses fillable restrictions
    Relations
      ✓ getAttribute() returns relation if set (1 ms)
      ✓ relations property initializes as empty object
      ✓ toArray() serializes relations with toArray method (1 ms)
      ✓ toArray() serializes array of relations (1 ms)
    Model State
      ✓ exists flag tracks if model is persisted (1 ms)
      ✓ wasRecentlyCreated flag tracks new records (17 ms)
    Chaining
      ✓ fill() returns this for chaining
      ✓ setAttribute() returns this for chaining
      ✓ setKey() returns this for chaining (1 ms)
      ✓ syncOriginal() returns this for chaining
      ✓ can chain multiple operations (10 ms)

PASS tests/unit/Database/models/Task.test.js
  Task Model
    Configuration
      ✓ should have correct table name (1450 ms)
      ✓ should have correct primary key (1 ms)
      ✓ should have timestamps enabled (1 ms)
      ✓ should have fillable fields defined (1 ms)
      ✓ should have casts defined (1 ms)
    Fillable Fields
      ✓ should include title field (1 ms)
      ✓ should include description field (1 ms)
      ✓ should include priority field
      ✓ should include status field (1 ms)
      ✓ should include due_date field
      ✓ should include completed_at field (1 ms)
      ✓ should have exactly 6 fillable fields (1 ms)
    Casts
      ✓ should cast priority to integer
      ✓ should cast due_date to datetime
      ✓ should cast completed_at to datetime (1 ms)
      ✓ should have exactly 3 casts defined
    Model Instance
      ✓ should create instance with new keyword (1 ms)
      ✓ should have attributes property (1 ms)
    Task Management Fields
      ✓ should have priority field for task prioritization
      ✓ should have status field for task state tracking
      ✓ should have due_date field for deadline tracking (1 ms)
      ✓ should have completed_at field for completion tracking (1 ms)
    Date Fields
      ✓ should cast date fields to datetime
      ✓ should support task scheduling with due_date
      ✓ should track completion time with completed_at (1 ms)
    Content Fields
      ✓ should have title for task identification
      ✓ should have description for task details

  console.error
    Error occurred: {
      message: 'Validation failed',
      statusCode: 422,
      code: 'VALIDATION_ERROR',
      stack: 'ValidationError: Validation failed\n' +
        '    at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/HandleErrors.test.js:41:21)\n' +
        '    at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)\n' +
        '    at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
        '    at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
        '    at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)\n' +
        '    at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)\n' +
        '    at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12)',
      url: '/api/test',
      method: 'GET',
      ip: '127.0.0.1',
      user: undefined
    }

      49 |
      50 |     // Log error details
    > 51 |     this.logger.error('Error occurred:', {
         |                 ^
      52 |       message: error.message,
      53 |       statusCode: error.statusCode || 500,
      54 |       code: error.code,

      at ExceptionHandler.report (framework/Exceptions/Handler.js:51:17)
      at ExceptionHandler.handle (framework/Exceptions/Handler.js:32:10)
      at framework/Exceptions/Handler.js:213:19
      at Object.<anonymous> (tests/unit/Http/Middleware/HandleErrors.test.js:43:7)

PASS tests/unit/Exceptions/ApiError.test.js
  ApiError
    constructor
      ✓ should create an error with default values (3 ms)
      ✓ should create an error with custom values (1 ms)
      ✓ should use constructor name as default code
      ✓ should have a stack trace (27 ms)
      ✓ should set error name to constructor name (1 ms)
      ✓ should set timestamp to ISO string
    toJSON
      ✓ should convert error to JSON format
      ✓ should omit errors field if no errors (1 ms)
      ✓ should include stack trace in development mode
      ✓ should not include stack trace in production mode (1 ms)
    getStatusCode
      ✓ should return the status code
    isOperationalError
      ✓ should return true for operational errors
      ✓ should return false for non-operational errors (1 ms)
      ✓ should default to operational (1 ms)
    inheritance
      ✓ should be instanceof Error
      ✓ should be instanceof ApiError
    error properties
      ✓ should maintain all properties after creation (1 ms)

  console.error
    Error occurred: {
      message: 'Not found',
      statusCode: 404,
      code: 'NOT_FOUND',
      stack: 'NotFoundError: Not found\n' +
        '    at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/HandleErrors.test.js:51:21)\n' +
        '    at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)\n' +
        '    at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
        '    at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
        '    at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)\n' +
        '    at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)\n' +
        '    at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12)',
      url: '/api/test',
      method: 'GET',
      ip: '127.0.0.1',
      user: undefined
    }

      49 |
      50 |     // Log error details
    > 51 |     this.logger.error('Error occurred:', {
         |                 ^
      52 |       message: error.message,
      53 |       statusCode: error.statusCode || 500,
      54 |       code: error.code,

      at ExceptionHandler.report (framework/Exceptions/Handler.js:51:17)
      at ExceptionHandler.handle (framework/Exceptions/Handler.js:32:10)
      at framework/Exceptions/Handler.js:213:19
      at Object.<anonymous> (tests/unit/Http/Middleware/HandleErrors.test.js:53:7)

  console.error
    Error occurred: {
      message: 'Route GET /api/test not found',
      statusCode: 404,
      code: 'NOT_FOUND',
      stack: 'NotFoundError: Route GET /api/test not found\n' +
        '    at /Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/HandleErrors.js:38:7\n' +
        '    at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/HandleErrors.test.js:110:7)\n' +
        '    at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)\n' +
        '    at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
        '    at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
        '    at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)\n' +
        '    at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)\n' +
        '    at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12)',
      url: '/api/test',
      method: 'GET',
      ip: '127.0.0.1',
      user: undefined
    }

      49 |
      50 |     // Log error details
    > 51 |     this.logger.error('Error occurred:', {
         |                 ^
      52 |       message: error.message,
      53 |       statusCode: error.statusCode || 500,
      54 |       code: error.code,

      at ExceptionHandler.report (framework/Exceptions/Handler.js:51:17)
      at ExceptionHandler.handle (framework/Exceptions/Handler.js:32:10)
      at framework/Exceptions/Handler.js:213:19
      at tests/unit/Http/Middleware/HandleErrors.test.js:112:9
      at framework/Http/Middleware/HandleErrors.js:37:5
      at Object.<anonymous> (tests/unit/Http/Middleware/HandleErrors.test.js:110:7)

PASS tests/unit/Http/Middleware/HandleErrors.test.js
  HandleErrors Middleware
    handleErrors
      ✓ should create error handler middleware (5 ms)
      ✓ should handle errors (93 ms)
      ✓ should pass options to exception handler (4 ms)
    notFoundHandler
      ✓ should create not found middleware (1 ms)
      ✓ should create NotFoundError (1 ms)
      ✓ should use custom message (1 ms)
    createExceptionHandler
      ✓ should create ExceptionHandler instance
      ✓ should create handler with custom options
    integration tests
      ✓ should work in middleware chain (3 ms)

PASS tests/unit/Pagination/Paginator.test.js
  Paginator
    LengthAwarePaginator
      Constructor
        ✓ should create paginator with items and total (11 ms)
        ✓ should set default current page to 1 (1 ms)
        ✓ should accept custom current page (38 ms)
        ✓ should set default path
        ✓ should accept custom options (1 ms)
        ✓ should handle non-array items (1 ms)
      setCurrentPage()
        ✓ should set valid page number
        ✓ should return 1 for invalid page number
        ✓ should handle string page numbers (1 ms)
      Page Information
        ✓ should return correct lastPage
        ✓ should return 1 for lastPage when total is 0
        ✓ should return correct count (1 ms)
        ✓ should return correct firstItem (1 ms)
        ✓ should return null for firstItem when no items (1 ms)
        ✓ should return correct lastItem (1 ms)
        ✓ should return null for lastItem when no items
      Navigation Checks
        ✓ should be on first page when currentPage is 1 (1 ms)
        ✓ should not be on first page when currentPage > 1
        ✓ should have more pages when not on last page
        ✓ should not have more pages when on last page
        ✓ should have pages when not on page 1 or has more pages (1 ms)
        ✓ should not have pages for single page
      URL Generation
        ✓ should generate URL for page (19 ms)
        ✓ should include existing query parameters (1 ms)
        ✓ should include fragment
        ✓ should use custom pageName
        ✓ should return page 1 URL for invalid page numbers (1 ms)
        ✓ should generate previousPageUrl
        ✓ should return null for previousPageUrl on first page
        ✓ should generate nextPageUrl
        ✓ should return null for nextPageUrl on last page
      getUrlRange()
        ✓ should generate URL range
      Serialization
        ✓ should convert to array (1 ms)
        ✓ should convert to JSON
    SimplePaginator
      Constructor
        ✓ should create simple paginator
        ✓ should detect hasMore when items exceed perPage
        ✓ should not have more when items equal perPage
        ✓ should slice items to perPage (1 ms)
        ✓ should accept custom current page
        ✓ should handle non-array items
      Page Information
        ✓ should return correct count
        ✓ should return correct firstItem
        ✓ should return correct lastItem
        ✓ should return null for firstItem when no items
      Navigation
        ✓ should have more pages when hasMore is true
        ✓ should not have more pages when hasMore is false (1 ms)
        ✓ should be on first page when currentPage is 1
        ✓ should generate previousPageUrl
        ✓ should return null for previousPageUrl on first page
        ✓ should generate nextPageUrl when hasMore
        ✓ should return null for nextPageUrl when no more pages
      URL Generation
        ✓ should generate URL with custom path
        ✓ should include query parameters
        ✓ should include fragment (1 ms)
      Serialization
        ✓ should convert to array (5 ms)
        ✓ should convert to JSON

PASS tests/unit/Cache/CacheStores.test.js
  Cache Stores
    FileStore
      ✓ should store values with expiration (8 ms)
      ✓ should retrieve stored values (1 ms)
      ✓ should delete values
      ✓ should flush all values (1 ms)
      ✓ should check if key exists
      ✓ should use MD5 hashing for keys (1 ms)
      ✓ should handle expiration properly
    MemoryStore
      ✓ should use Map for storage (1 ms)
      ✓ should store and retrieve values
      ✓ should track expirations (1 ms)
      ✓ should provide cache statistics (1 ms)
      ✓ should cleanup expired entries (10 ms)
    CacheManager
      ✓ should create file driver
      ✓ should create memory driver
      ✓ should create redis driver (1 ms)
      ✓ should switch between stores

PASS tests/unit/Media/MediaServer.test.js
  Media Server
    MediaServerMiddleware
      ✓ should parse transformation query parameters (10 ms)
      ✓ should support short query param names (2 ms)
      ✓ should determine output format from Accept header (1 ms)
      ✓ should prioritize query format over Accept header (1 ms)
      ✓ should generate ETag for caching (1 ms)
      ✓ should handle 304 Not Modified
    CDNManager
      ✓ should generate CDN URL (1 ms)
      ✓ should generate image URL with transformations (1 ms)
      ✓ should generate responsive image URLs (1 ms)
      ✓ should generate srcset attribute (1 ms)
      ✓ should handle cache purging
    Image Transformations
      ✓ should resize images (1 ms)
      ✓ should support fit modes
      ✓ should convert formats
      ✓ should apply filters
    Cache Headers
      ✓ should set Cache-Control header (3 ms)
      ✓ should set Vary header for content negotiation (1 ms)
      ✓ should set CORS headers

PASS tests/unit/GeoIP/GeoIPProviders.test.js
  GeoIP Providers
    GeoIPProvider Base Class
      ✓ should not allow direct instantiation (1 ms)
      ✓ should provide caching functionality
      ✓ should validate IP addresses (1 ms)
    MaxMindProvider
      ✓ should initialize database (2 ms)
      ✓ should locate IP address (1 ms)
      ✓ should get country from IP (1 ms)
      ✓ should cache lookup results (1 ms)
      ✓ should return coordinates (1 ms)
    IP2LocationProvider
      ✓ should initialize database (1 ms)
      ✓ should locate IP address (12 ms)
      ✓ should provide ISP information (1 ms)
      ✓ should provide domain information
      ✓ should provide usage type
    GeoIPManager
      ✓ should switch between providers (1 ms)
      ✓ should use default provider (2 ms)
      ✓ should proxy locate method (1 ms)
      ✓ should proxy getCountry method (17 ms)

PASS tests/unit/Database/QueryBuilder.test.js
  QueryBuilder
    Constructor
      ✓ initializes with connection and table name (12 ms)
    Select Methods
      ✓ select() adds columns to query (2 ms)
      ✓ select() with single column
      ✓ select() supports chaining (1 ms)
    Where Clauses
      ✓ where() with operator and value (2 ms)
      ✓ where() with value only (assumes equality) (17 ms)
      ✓ orWhere() adds OR condition
      ✓ orWhere() with operator (1 ms)
      ✓ whereIn() filters by array values
      ✓ whereNotIn() excludes array values (1 ms)
      ✓ whereNull() checks for null values
      ✓ whereNotNull() checks for non-null values
      ✓ chains multiple where clauses
    Ordering and Limiting
      ✓ orderBy() sorts ascending by default (1 ms)
      ✓ orderBy() with descending direction
      ✓ limit() restricts result count (1 ms)
      ✓ offset() skips records
      ✓ chains order, limit, and offset
    Joins
      ✓ join() performs inner join (1 ms)
      ✓ leftJoin() performs left outer join
      ✓ chains multiple joins (1 ms)
    Grouping and Having
      ✓ groupBy() with single column
      ✓ groupBy() with multiple columns
      ✓ having() with operator and value (1 ms)
      ✓ having() with value only (1 ms)
      ✓ chains groupBy and having
    Retrieval Methods
      ✓ get() returns all results (1 ms)
      ✓ first() returns single result
      ✓ find() retrieves by ID
      ✓ count() returns total records (1 ms)
      ✓ count() with specific column
    Modification Methods
      ✓ insert() creates new record
      ✓ update() modifies records
      ✓ delete() removes records (1 ms)
    Pagination
      ✓ paginate() with default page and perPage (1 ms)
      ✓ paginate() with custom page
      ✓ paginate() calculates correct pagination metadata
      ✓ paginate() handles last page correctly (1 ms)
    Complex Queries
      ✓ builds complex query with multiple clauses
      ✓ builds query with joins and grouping (1 ms)
    Utility Methods
      ✓ getRawQuery() returns underlying query object
      ✓ maintains fluent interface throughout chain
    Edge Cases
      ✓ handles empty where values
      ✓ handles zero values (1 ms)
      ✓ handles empty array in whereIn (9 ms)
      ✓ handles limit(0) (1 ms)
      ✓ handles offset(0)
      ✓ paginate with page 1 has correct from value

PASS tests/unit/Routing/Router.test.js
  Router
    Constructor
      ✓ should create a new Router instance (18 ms)
      ✓ should initialize with Express router (1 ms)
      ✓ should have getRouter method
    HTTP Method Registration
      ✓ should register GET route (13 ms)
      ✓ should register POST route (1 ms)
      ✓ should register PUT route
      ✓ should register PATCH route
      ✓ should register DELETE route
      ✓ should register ANY route (all methods)
      ✓ should accept multiple handlers (1 ms)
      ✓ should handle route with parameters
      ✓ should handle nested route paths (1 ms)
    Method Chaining
      ✓ should chain GET routes
      ✓ should chain different HTTP methods (1 ms)
      ✓ should chain with middleware
    group()
      ✓ should create route group with prefix (1 ms)
      ✓ should create route group with middleware
      ✓ should create route group with prefix and middleware (1 ms)
      ✓ should handle nested groups
      ✓ should use default prefix if not provided (1 ms)
      ✓ should pass new Router instance to callback
    use()
      ✓ should apply single middleware
      ✓ should apply multiple middleware (28 ms)
      ✓ should return router for chaining
    getRouter()
      ✓ should return Express router instance
      ✓ should return same instance on multiple calls
    Integration
      ✓ should work with complex routing scenario (1 ms)
      ✓ should handle empty routes gracefully

PASS tests/unit/Database/models/Comment.test.js
  Comment Model
    Configuration
      ✓ should have correct table name (912 ms)
      ✓ should have correct primary key (1 ms)
      ✓ should have timestamps enabled (1 ms)
      ✓ should have fillable fields defined (1 ms)
      ✓ should have casts defined (3 ms)
    Fillable Fields
      ✓ should include post_id field
      ✓ should include author field (1 ms)
      ✓ should include content field
      ✓ should have exactly 3 fillable fields
    Casts
      ✓ should cast post_id to integer
      ✓ should have exactly 1 cast defined (1 ms)
    Relationships
      ✓ should have post relationship method (1 ms)
    Model Instance
      ✓ should create instance with new keyword (4 ms)
      ✓ should have attributes property (1 ms)
    Foreign Key
      ✓ should have post_id in fillable for relationship
      ✓ should cast post_id to integer for proper foreign key handling (1 ms)
    Content Management
      ✓ should have author field for comment attribution
      ✓ should have content field for comment text

PASS tests/unit/Filesystem/Filesystem.test.js
  Filesystem
    File Existence
      ✓ exists() returns true for existing file (3 ms)
      ✓ exists() returns false for non-existing file (1 ms)
      ✓ missing() returns true for non-existing file
      ✓ missing() returns false for existing file (1 ms)
      ✓ isFile() returns true for files (2 ms)
      ✓ isFile() returns false for directories (1 ms)
      ✓ isDirectory() returns true for directories
      ✓ isDirectory() returns false for files (2 ms)
    Reading Files
      ✓ get() reads file contents (10 ms)
      ✓ get() throws error for non-existing file (4 ms)
      ✓ get() returns null when throwError is false (1 ms)
      ✓ getJson() parses JSON file (41 ms)
      ✓ hash() returns MD5 hash of file (2 ms)
      ✓ hash() returns consistent hash for same content (2 ms)
    Writing Files
      ✓ put() creates new file (1 ms)
      ✓ put() creates directory if missing (2 ms)
      ✓ put() overwrites existing file (1 ms)
      ✓ replace() writes atomically (2 ms)
      ✓ prepend() adds content to beginning (1 ms)
      ✓ prepend() creates file if missing (2 ms)
      ✓ append() adds content to end (1 ms)
    Deleting Files
      ✓ delete() removes single file (2 ms)
      ✓ delete() removes multiple files (1 ms)
      ✓ delete() returns true even if file does not exist (1 ms)
    Moving and Copying
      ✓ move() renames file (1 ms)
      ✓ copy() duplicates file (2 ms)
    File Information
      ✓ name() returns filename without extension (4 ms)
      ✓ basename() returns full filename (2 ms)
      ✓ dirname() returns directory path
      ✓ extension() returns file extension (11 ms)
      ✓ type() returns MIME type (1 ms)
      ✓ size() returns file size in bytes (1 ms)
      ✓ lastModified() returns timestamp (3 ms)
    Permissions
      ✓ isReadable() returns true for readable files (2 ms)
      ✓ isWritable() returns true for writable files (2 ms)
      ✓ chmod() changes file permissions (4 ms)
      ✓ chmod() returns current mode when mode is null (1 ms)
    Directory Operations
      ✓ makeDirectory() creates directory (1 ms)
      ✓ makeDirectory() creates nested directories with recursive option (1 ms)
      ✓ files() returns files in directory (2 ms)
      ✓ files() with recursive option (2 ms)
      ✓ allFiles() returns all files recursively (1 ms)
      ✓ directories() returns subdirectories (2 ms)
      ✓ copyDirectory() copies entire directory (2 ms)
      ✓ moveDirectory() moves directory (1 ms)
      ✓ deleteDirectory() removes directory and contents (2 ms)
      ✓ cleanDirectory() empties directory but preserves it (1 ms)
    Edge Cases
      ✓ handles empty file content (1 ms)
      ✓ handles large file content (6 ms)
      ✓ handles special characters in content (1 ms)
      ✓ handles paths with spaces (1 ms)
      ✓ files() returns empty array for non-directory (1 ms)
      ✓ directories() returns empty array for non-directory (1 ms)

PASS tests/unit/Services/Mail/MailManager.test.js
  MailManager
    Constructor
      ✓ should initialize with app instance (58 ms)
      ✓ should create separate instances for different apps (2 ms)
    mailer()
      ✓ should return default mailer when no name provided (3 ms)
      ✓ should cache mailer instances (1 ms)
      ✓ should create different instances for different mailer names (1 ms)
    resolve()
      ✓ should throw error when mailer is not configured (4 ms)
      ✓ should throw error when transport is missing (1 ms)
      ✓ should use custom creator when available (1 ms)
      ✓ should throw error for unsupported transport (1 ms)
    Transport Creation Methods
      ✓ should have createSmtpTransport method (1 ms)
      ✓ should have createSendgridTransport method
      ✓ should follow naming convention for transport methods (1 ms)
    extend()
      ✓ should register custom creator
      ✓ should allow multiple custom creators (1 ms)
      ✓ should support fluent interface (1 ms)
    getConfig()
      ✓ should retrieve mailer configuration (1 ms)
      ✓ should return undefined for nonexistent mailer (1 ms)
      ✓ should return default value when mailers not configured
    getDefaultDriver()
      ✓ should return configured default driver (1 ms)
      ✓ should return smtp as fallback default (1 ms)
    capitalize()
      ✓ should capitalize first letter
      ✓ should handle single character (1 ms)
      ✓ should handle already capitalized
      ✓ should handle empty string
    send()
      ✓ should proxy to default mailer
      ✓ should pass through all mail options (1 ms)
    Integration Scenarios
      ✓ should support multiple mailers simultaneously (1 ms)
      ✓ should allow custom mailer to override built-in (1 ms)
      ✓ should handle mailer creation errors gracefully (1 ms)
      ✓ should resolve correct method name for transport (1 ms)

PASS tests/unit/Support/Helpers/OtpHelper.test.js
  OtpHelper
    generateOTP
      ✓ should generate numeric OTP of default length (2 ms)
      ✓ should generate OTP of custom length
      ✓ should generate unique OTPs (1 ms)
      ✓ should throw for invalid lengths (5 ms)
    generateAlphanumericOTP
      ✓ should generate alphanumeric OTP
      ✓ should generate OTP of custom length
      ✓ should throw for invalid lengths (1 ms)
    generateSecureOTP
      ✓ should generate secure numeric OTP (1 ms)
      ✓ should generate OTP of custom length (1 ms)
    hashOTP and verifyOTPHash
      ✓ should hash and verify OTP (1 ms)
      ✓ should reject incorrect OTP
      ✓ should produce different hashes with different secrets (1 ms)
    createOTPRecord
      ✓ should create OTP record with default options (2 ms)
      ✓ should create alphanumeric OTP
      ✓ should create secure OTP (1 ms)
      ✓ should hash OTP when secret provided
      ✓ should set custom expiration (1 ms)
      ✓ should include metadata
    verifyOTPRecord
      ✓ should verify valid OTP (1 ms)
      ✓ should reject invalid OTP (1 ms)
      ✓ should track attempts
      ✓ should enforce max attempts (1 ms)
      ✓ should detect expired OTP
      ✓ should mark record as verified on success (1 ms)
      ✓ should reject already verified OTP
      ✓ should provide remaining attempts
      ✓ should support auto-increment toggle (1 ms)
    isOTPExpired
      ✓ should detect expired OTP (1 ms)
      ✓ should detect non-expired OTP
    getRemainingTime
      ✓ should calculate remaining time (1 ms)
      ✓ should return 0 for expired OTP
    formatOTP
      ✓ should format OTP with default group size
      ✓ should format OTP with custom group size (1 ms)
    generateTOTP
      ✓ should generate TOTP
      ✓ should generate TOTP with custom digits (1 ms)
      ✓ should generate same TOTP in same time window
    verifyTOTP
      ✓ should verify valid TOTP (1 ms)
      ✓ should reject invalid TOTP
      ✓ should support tolerance for time drift (22 ms)
    generateBackupCodes
      ✓ should generate backup codes (14 ms)
      ✓ should generate custom number of codes (1 ms)
      ✓ should generate codes of custom length (1 ms)
      ✓ should generate unique codes (1 ms)
    OtpHelper class
      ✓ should generate OTP (1 ms)
      ✓ should create OTP record
      ✓ should verify OTP (1 ms)
      ✓ should hash OTP
      ✓ should verify hash (1 ms)
      ✓ should generate TOTP
      ✓ should verify TOTP
      ✓ should provide static methods (1 ms)

PASS tests/unit/Database/Scope.test.js
  Scope
    Base Scope
      ✓ can be instantiated (3 ms)
      ✓ has apply method (1 ms)
      ✓ apply method can be called
      ✓ can be extended with custom logic (1 ms)
    SoftDeletingScope
      ✓ apply() adds whereNull constraint for deleted_at
      ✓ apply() uses custom deletedAt column (1 ms)
      ✓ apply() returns query for chaining
      ✓ extend() adds withTrashed method (1 ms)
      ✓ extend() adds onlyTrashed method
      ✓ extend() adds restore method (1 ms)
      ✓ withTrashed() returns query without soft delete filter (2 ms)
      ✓ onlyTrashed() adds whereNotNull constraint
      ✓ onlyTrashed() uses custom deletedAt column
      ✓ restore() updates deleted_at to null (2 ms)
      ✓ restore() uses custom deletedAt column
      ✓ extend() returns query
    ActiveScope
      ✓ applies where clause for active status
      ✓ returns query for chaining (1 ms)
    PublishedScope
      ✓ applies where clause for published status
      ✓ returns query for chaining (1 ms)
    VerifiedScope
      ✓ applies whereNotNull clause for email_verified_at
      ✓ returns query for chaining (1 ms)
    LocalScope
      ✓ has create static method
      ✓ create() returns a function
      ✓ create() function executes callback with query
      ✓ create() passes arguments to callback
      ✓ active() scope filters by active status (1 ms)
      ✓ active() returns query for chaining (1 ms)
    Scope Composition
      ✓ multiple scopes can be applied to same query
      ✓ soft delete scope can be combined with other scopes (1 ms)
      ✓ scopes maintain query chain
    Custom Scope Patterns
      ✓ can create date-based scope (1 ms)
      ✓ can create user-specific scope
      ✓ can create complex filtering scope (15 ms)

PASS tests/unit/Database/Observer.test.js
  Observer
    Observer Methods
      ✓ has retrieved method (10 ms)
      ✓ has creating method (1 ms)
      ✓ has created method
      ✓ has updating method
      ✓ has updated method
      ✓ has saving method (1 ms)
      ✓ has saved method
      ✓ has deleting method
      ✓ has deleted method (1 ms)
      ✓ has restoring method
      ✓ has restored method
      ✓ has forceDeleted method (1 ms)
    Custom Observer
      ✓ can be extended with custom logic
      ✓ inherits all base observer methods
      ✓ can override multiple methods (1 ms)
    observe() Function
      ✓ throws error if dispatcher not set (11 ms)
      ✓ registers observer with model dispatcher
      ✓ accepts observer class and instantiates it (1 ms)
      ✓ accepts observer instance
      ✓ registers all lifecycle events (1 ms)
      ✓ only registers events that are defined in observer (12 ms)
      ✓ event listeners receive model as parameter
      ✓ supports all 12 lifecycle events (1 ms)
    Observer Patterns
      ✓ can track model state changes (1 ms)
      ✓ can validate data before save (1 ms)
      ✓ can modify data before persistence
      ✓ can send notifications on events (1 ms)

PASS tests/unit/Foundation/BaseService.test.js
  BaseService
    constructor
      ✓ initializes with model (36 ms)
      ✓ sets default properties (5 ms)
    findAll
      ✓ returns paginated results with defaults (3 ms)
      ✓ applies custom page and limit (1 ms)
      ✓ enforces maxPerPage (1 ms)
      ✓ applies sorting when field is sortable
      ✓ ignores sorting for non-sortable fields (2 ms)
      ✓ applies filters when filterableFields configured
      ✓ applies search when searchableFields configured (1 ms)
    findById
      ✓ returns record when found (14 ms)
      ✓ throws NotFoundError when not found (3 ms)
      ✓ uses custom notFoundMessage (1 ms)
    findOne
      ✓ returns record when found
      ✓ returns null when not found (1 ms)
      ✓ throws when throwIfNotFound option is true (1 ms)
      ✓ applies multiple criteria
    create
      ✓ creates record
      ✓ calls beforeCreate hook if defined (1 ms)
      ✓ calls afterCreate hook if defined (1 ms)
    update
      ✓ updates record by ID (1 ms)
      ✓ throws NotFoundError when record not found
      ✓ calls beforeUpdate hook if defined (1 ms)
      ✓ calls afterUpdate hook if defined
    delete
      ✓ deletes record by ID
      ✓ throws NotFoundError when record not found
      ✓ calls beforeDelete hook if defined
      ✓ calls afterDelete hook if defined (1 ms)
    bulkCreate
      ✓ creates multiple records
      ✓ returns empty array for empty input (1 ms)
    bulkUpdate
      ✓ updates multiple records
    bulkDelete
      ✓ deletes multiple records (1 ms)
    count
      ✓ counts all records without criteria
      ✓ counts records with criteria (1 ms)
    exists
      ✓ returns true when records exist
      ✓ returns false when no records exist
    applyFilters
      ✓ applies simple equality filter (1 ms)
      ✓ applies array filter with whereIn
      ✓ applies gt operator (1 ms)
      ✓ applies gte operator
      ✓ applies lt operator (26 ms)
      ✓ applies lte operator (1 ms)
      ✓ applies like operator
      ✓ applies ne (not equal) operator (1 ms)
      ✓ ignores non-filterable fields
      ✓ applies multiple filters
    applySearch
      ✓ applies search to multiple fields (1 ms)
      ✓ returns unchanged query when no search term
      ✓ returns unchanged query when no fields (1 ms)
    paginatedResponse
      ✓ formats basic pagination response (1 ms)
      ✓ calculates correct from and to for middle page (1 ms)
      ✓ calculates correct to for last partial page
      ✓ includes correct navigation links (1 ms)
      ✓ sets prev to null on first page (1 ms)
      ✓ sets next to null on last page
    getModel
      ✓ returns the model instance

PASS tests/unit/Services/UploadManager.test.js
  UploadManager
    Constructor
      ✓ initializes with app instance (3 ms)
    Disk Management
      ✓ disk() returns default disk when no name provided (1 ms)
      ✓ disk() returns specific disk by name (1 ms)
      ✓ disk() caches disk instances
      ✓ getDefaultDisk() returns configured default (2 ms)
      ✓ availableDisks() returns list of configured disks (1 ms)
    File Parsing
      ✓ parseFile() handles Buffer input (1 ms)
      ✓ parseFile() handles base64 string (1 ms)
      ✓ parseFile() handles file object (1 ms)
      ✓ parseFile() throws error for invalid input (4 ms)
    Upload Operations
      ✓ upload() uploads file successfully (2 ms)
      ✓ upload() with custom filename (1 ms)
      ✓ upload() with custom disk
      ✓ uploadMultiple() uploads multiple files (1 ms)
      ✓ uploadMultiple() handles partial failures (1 ms)
    File Operations
      ✓ delete() removes file (1 ms)
      ✓ delete() with custom disk
      ✓ deleteMultiple() removes multiple files (1 ms)
      ✓ exists() checks file existence
      ✓ url() returns file URL (1 ms)
      ✓ getMetadata() returns file metadata (1 ms)
      ✓ download() retrieves file
    File Manipulation
      ✓ copy() duplicates file (1 ms)
      ✓ move() relocates file
    Helper Methods
      ✓ isImage() returns true for image MIME types (1 ms)
      ✓ isImage() returns false for non-image MIME types
      ✓ generateFilename() creates unique filename (1 ms)
      ✓ getExtension() extracts file extension
      ✓ generateThumbnailPath() creates thumbnail path
      ✓ generateThumbnailPath() handles files without extension
      ✓ capitalize() capitalizes first letter
    Custom Drivers
      ✓ extend() registers custom driver creator (1 ms)
      ✓ extend() returns manager for chaining
    Configuration
      ✓ getConfig() returns disk configuration
      ✓ getConfig() returns undefined for non-existing disk (1 ms)
    Edge Cases
      ✓ handles empty buffer upload
      ✓ handles file without path option
      ✓ deleteMultiple() handles empty array (1 ms)
      ✓ uploadMultiple() handles empty array

  console.error
    Error occurred: {
      message: 'User not found',
      statusCode: 404,
      code: 'NOT_FOUND',
      stack: 'NotFoundError: User not found\n' +
        '    at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Exceptions/Handler.test.js:62:21)\n' +
        '    at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)\n' +
        '    at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
        '    at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
        '    at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)\n' +
        '    at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)\n' +
        '    at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12)',
      url: '/api/test',
      method: 'GET',
      ip: '127.0.0.1',
      user: undefined
    }

      49 |
      50 |     // Log error details
    > 51 |     this.logger.error('Error occurred:', {
         |                 ^
      52 |       message: error.message,
      53 |       statusCode: error.statusCode || 500,
      54 |       code: error.code,

      at ExceptionHandler.report (framework/Exceptions/Handler.js:51:17)
      at ExceptionHandler.handle (framework/Exceptions/Handler.js:32:10)
      at Object.<anonymous> (tests/unit/Exceptions/Handler.test.js:64:15)

  console.error
    Error occurred: {
      message: 'Something went wrong',
      statusCode: 500,
      code: undefined,
      stack: 'Error: Something went wrong\n' +
        '    at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Exceptions/Handler.test.js:76:21)\n' +
        '    at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)\n' +
        '    at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
        '    at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
        '    at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)\n' +
        '    at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)\n' +
        '    at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12)',
      url: '/api/test',
      method: 'GET',
      ip: '127.0.0.1',
      user: undefined
    }

      49 |
      50 |     // Log error details
    > 51 |     this.logger.error('Error occurred:', {
         |                 ^
      52 |       message: error.message,
      53 |       statusCode: error.statusCode || 500,
      54 |       code: error.code,

      at ExceptionHandler.report (framework/Exceptions/Handler.js:51:17)
      at ExceptionHandler.handle (framework/Exceptions/Handler.js:32:10)
      at Object.<anonymous> (tests/unit/Exceptions/Handler.test.js:78:15)

  console.error
    Error occurred: {
      message: 'User not found',
      statusCode: 404,
      code: 'NOT_FOUND',
      stack: 'NotFoundError: User not found\n' +
        '    at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Exceptions/Handler.test.js:314:21)\n' +
        '    at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)\n' +
        '    at new Promise (<anonymous>)\n' +
        '    at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)\n' +
        '    at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)\n' +
        '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
        '    at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)\n' +
        '    at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)\n' +
        '    at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n' +
        '    at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n' +
        '    at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)\n' +
        '    at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)\n' +
        '    at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12)',
      url: '/api/test',
      method: 'GET',
      ip: '127.0.0.1',
      user: undefined
    }

      49 |
      50 |     // Log error details
    > 51 |     this.logger.error('Error occurred:', {
         |                 ^
      52 |       message: error.message,
      53 |       statusCode: error.statusCode || 500,
      54 |       code: error.code,

      at ExceptionHandler.report (framework/Exceptions/Handler.js:51:17)
      at ExceptionHandler.handle (framework/Exceptions/Handler.js:32:10)
      at framework/Exceptions/Handler.js:213:19
      at Object.<anonymous> (tests/unit/Exceptions/Handler.test.js:316:7)

PASS tests/unit/Exceptions/Handler.test.js
  ExceptionHandler
    constructor
      ✓ should create handler with default options (4 ms)
      ✓ should create handler with custom options (1 ms)
    handle
      ✓ should handle ApiError and send response (17 ms)
      ✓ should handle generic Error and convert to ApiError (5 ms)
    report
      ✓ should log error details (1 ms)
      ✓ should not report errors in dontReport list (1 ms)
    convertToApiError
      ✓ should return ApiError as-is
      ✓ should convert Joi ValidationError (1 ms)
      ✓ should convert JsonWebTokenError (2 ms)
      ✓ should convert TokenExpiredError (1 ms)
      ✓ should convert generic Error to InternalServerError
      ✓ should include error message in debug mode
      ✓ should hide error message in production mode
    formatErrorResponse
      ✓ should format error response with required fields (1 ms)
      ✓ should include validation errors
      ✓ should include stack trace in debug mode (1 ms)
      ✓ should not include stack trace in production mode (1 ms)
    formatJoiErrors
      ✓ should format Joi error details to object (1 ms)
    shouldReport
      ✓ should return true for reportable errors
      ✓ should return false for non-reportable errors
      ✓ should trigger reportToExternalService when error should be reported (1 ms)
    shouldntReport
      ✓ should return true for errors in dontReport list
      ✓ should return false for other errors (1 ms)
    middleware
      ✓ should return Express middleware function (1 ms)
      ✓ should handle errors when used as middleware (4 ms)
    createExceptionHandler
      ✓ should create new ExceptionHandler instance
    integration tests
      ✓ should handle complete error flow (2 ms)

PASS tests/unit/Services/Storage/StorageManager.test.js
  StorageManager
    Constructor
      ✓ should initialize with app instance (10 ms)
      ✓ should create separate instances for different apps (2 ms)
    disk()
      ✓ should return default disk when no name provided (2 ms)
      ✓ should cache disk instances (1 ms)
      ✓ should create different instances for different disk names (1 ms)
    cloud()
      ✓ should return default cloud disk (1 ms)
      ✓ should fallback to s3 as default cloud driver (1 ms)
    resolve()
      ✓ should throw error when disk is not configured (15 ms)
      ✓ should throw error when driver is missing (1 ms)
      ✓ should use custom creator when available
      ✓ should throw error for unsupported driver (2 ms)
    Driver Creation Methods
      ✓ should have createLocalDriver method (1 ms)
      ✓ should have createS3Driver method
      ✓ should follow naming convention for driver methods (1 ms)
    extend()
      ✓ should register custom creator (1 ms)
      ✓ should allow multiple custom creators (1 ms)
      ✓ should support fluent interface
    getConfig()
      ✓ should retrieve disk configuration (1 ms)
      ✓ should return undefined for nonexistent disk (27 ms)
      ✓ should return default value when disks not configured (1 ms)
    getDefaultDriver()
      ✓ should return configured default driver (1 ms)
      ✓ should return local as fallback default
    getDefaultCloudDriver()
      ✓ should return configured default cloud driver (1 ms)
      ✓ should return s3 as fallback default
    capitalize()
      ✓ should capitalize first letter (1 ms)
      ✓ should handle single character (1 ms)
      ✓ should handle already capitalized
      ✓ should handle empty string (1 ms)
    Proxy Methods
      put()
        ✓ should proxy to default disk (1 ms)
        ✓ should pass all arguments (1 ms)
      get()
        ✓ should proxy to default disk (1 ms)
      exists()
        ✓ should proxy to default disk (1 ms)
      delete()
        ✓ should proxy to default disk (1 ms)
        ✓ should pass multiple files (5 ms)
      url()
        ✓ should proxy to default disk
      size()
        ✓ should proxy to default disk (1 ms)
      files()
        ✓ should proxy to default disk (1 ms)
      copy()
        ✓ should proxy to default disk (1 ms)
      move()
        ✓ should proxy to default disk (2 ms)
    Integration Scenarios
      ✓ should support multiple disks simultaneously (1 ms)
      ✓ should allow custom disk to override built-in (2 ms)
      ✓ should handle disk creation errors gracefully (18 ms)
      ✓ should resolve correct method name for driver (1 ms)
      ✓ should support cloud disk access pattern (12 ms)

PASS tests/unit/Support/Helpers/DateHelper.test.js
  DateHelper - Functional API
    formatDate
      ✓ formats date with default format (4 ms)
      ✓ formats date with custom format YYYY-MM-DD (1 ms)
      ✓ formats date with time tokens (1 ms)
      ✓ formats date with 12-hour format (1 ms)
      ✓ formats date with lowercase am/pm
      ✓ formats date with year abbreviation
      ✓ formats date with single digit tokens
      ✓ throws error for invalid date (3 ms)
      ✓ accepts string date
      ✓ accepts timestamp (1 ms)
    parseDate
      ✓ parses date string without format (1 ms)
      ✓ parses date string with format
      ✓ returns invalid date for invalid string
    addTime
      ✓ adds days by default (1 ms)
      ✓ adds years (1 ms)
      ✓ adds months
      ✓ adds weeks
      ✓ adds hours
      ✓ adds minutes
      ✓ adds seconds (1 ms)
      ✓ adds milliseconds
      ✓ throws error for invalid unit (2 ms)
      ✓ accepts string date
    subtractTime
      ✓ subtracts days by default (1 ms)
      ✓ subtracts years (16 ms)
      ✓ subtracts months (1 ms)
      ✓ subtracts hours
    diffTime
      ✓ calculates difference in milliseconds by default (1 ms)
      ✓ calculates difference in days
      ✓ calculates difference in hours
      ✓ calculates difference in minutes (1 ms)
      ✓ calculates difference in seconds
      ✓ calculates difference in weeks
      ✓ calculates difference in months (1 ms)
      ✓ calculates difference in years
      ✓ throws error for invalid unit (1 ms)
      ✓ returns negative for past dates
    isPast
      ✓ returns true for past date
      ✓ returns false for future date (3 ms)
      ✓ accepts string date
    isFuture
      ✓ returns true for future date
      ✓ returns false for past date (1 ms)
      ✓ accepts string date
    isToday
      ✓ returns true for today
      ✓ returns false for yesterday (1 ms)
      ✓ returns false for tomorrow
    isYesterday
      ✓ returns true for yesterday
      ✓ returns false for today (1 ms)
      ✓ returns false for two days ago
    isTomorrow
      ✓ returns true for tomorrow
      ✓ returns false for today
      ✓ returns false for two days from now
    isLeapYear
      ✓ returns true for leap year divisible by 400 (1 ms)
      ✓ returns true for leap year divisible by 4 but not 100
      ✓ returns false for year divisible by 100 but not 400
      ✓ returns false for non-leap year (1 ms)
    startOf
      ✓ gets start of day (1 ms)
      ✓ gets start of week (1 ms)
      ✓ gets start of month
      ✓ gets start of year (1 ms)
      ✓ gets start of hour
      ✓ gets start of minute (1 ms)
      ✓ gets start of second
      ✓ throws error for invalid period (1 ms)
    endOf
      ✓ gets end of day (1 ms)
      ✓ gets end of week
      ✓ gets end of month (1 ms)
      ✓ gets end of year (1 ms)
      ✓ gets end of hour
      ✓ gets end of minute (1 ms)
      ✓ gets end of second
      ✓ throws error for invalid period (18 ms)
    timeAgo
      ✓ returns "just now" for very recent date
      ✓ returns seconds ago (1 ms)
      ✓ returns 1 second ago for singular
      ✓ returns minutes ago
      ✓ returns hours ago (1 ms)
      ✓ returns days ago
      ✓ returns weeks ago
      ✓ returns months ago (1 ms)
      ✓ returns years ago
    timeUntil
      ✓ returns "already passed" for past date (1 ms)
      ✓ returns "in a moment" for very near future
      ✓ returns in seconds
      ✓ returns in 1 second for singular (1 ms)
      ✓ returns in minutes
      ✓ returns in hours (8 ms)
      ✓ returns in days
      ✓ returns in weeks (1 ms)
    getTimezoneOffset
      ✓ returns timezone offset in hours (1 ms)
      ✓ accepts date parameter
    toUTC
      ✓ converts date to UTC
    fromUTC
      ✓ converts UTC date to local (1 ms)
    getWeekNumber
      ✓ returns week number (1 ms)
    getQuarter
      ✓ returns Q1 for January
      ✓ returns Q2 for April
      ✓ returns Q3 for July (1 ms)
      ✓ returns Q4 for December
    isSameDay
      ✓ returns true for same day
      ✓ returns false for different days (1 ms)
    isBetween
      ✓ returns true for date between range (inclusive) (1 ms)
      ✓ returns true for date at start (inclusive)
      ✓ returns false for date at start (exclusive)
      ✓ returns false for date outside range (1 ms)
  DateHelper - Class API
    constructor
      ✓ creates instance with current date by default
      ✓ creates instance with provided date
      ✓ creates instance with string date (1 ms)
    fluent API
      ✓ chains add operations
      ✓ chains subtract operations
      ✓ chains startOf operations (1 ms)
      ✓ chains endOf operations
    format method
      ✓ formats date (1 ms)
    diff method
      ✓ calculates difference from another date (1 ms)
    comparison methods
      ✓ isPast returns correct value
      ✓ isFuture returns correct value (1 ms)
      ✓ isToday returns correct value (33 ms)
    toDate method
      ✓ returns native Date object
    clone method
      ✓ creates independent copy (1 ms)

  console.error
    Failed to clear cache: ENOENT: no such file or directory, scandir '/tmp/media-cache'

      241 |       return cleared;
      242 |     } catch (error) {
    > 243 |       console.error('Failed to clear cache:', error.message);
          |               ^
      244 |       return 0;
      245 |     }
      246 |   }

      at MediaManager.clearExpiredCache (framework/Services/Media/MediaManager.js:243:15)
      at Object.<anonymous> (tests/unit/Services/MediaManager.test.js:266:21)

  console.error
    Failed to clear cache: ENOENT: no such file or directory, scandir '/tmp/media-cache'

      261 |       return jpgFiles.length;
      262 |     } catch (error) {
    > 263 |       console.error('Failed to clear cache:', error.message);
          |               ^
      264 |       return 0;
      265 |     }
      266 |   }

      at MediaManager.clearAllCache (framework/Services/Media/MediaManager.js:263:15)
      at Object.<anonymous> (tests/unit/Services/MediaManager.test.js:272:21)

PASS tests/unit/Services/MediaManager.test.js
  MediaManager
    Constructor
      ✓ initializes with app instance (12 ms)
      ✓ sets cache configuration
      ✓ sets thumbnail configuration (3 ms)
    Dimension Validation
      ✓ validateDimensions() accepts valid dimensions (1 ms)
      ✓ validateDimensions() rejects zero dimensions (32 ms)
      ✓ validateDimensions() rejects negative dimensions (1 ms)
      ✓ validateDimensions() rejects dimensions exceeding maximum (1 ms)
      ✓ validateDimensions() rejects height exceeding maximum (13 ms)
      ✓ validateDimensions() enforces strict sizes when enabled (3 ms)
    Cache Key Generation
      ✓ getCacheKey() generates MD5 hash (22 ms)
      ✓ getCacheKey() returns same key for same inputs (1 ms)
      ✓ getCacheKey() returns different keys for different inputs (1 ms)
      ✓ getCacheKey() uses MD5 algorithm
    Content Type Detection
      ✓ getContentType() returns correct MIME for JPG
      ✓ getContentType() returns correct MIME for PNG
      ✓ getContentType() returns correct MIME for GIF (1 ms)
      ✓ getContentType() returns correct MIME for WebP
      ✓ getContentType() returns correct MIME for SVG
      ✓ getContentType() handles case insensitivity (1 ms)
      ✓ getContentType() returns default for unknown extensions
    Allowed Sizes
      ✓ getAllowedSizes() returns configured sizes (2 ms)
      ✓ getAllowedSizes() includes URL parameters
      ✓ getAllowedSizes() preserves all size properties (5 ms)
    Byte Formatting
      ✓ formatBytes() formats bytes (2 ms)
      ✓ formatBytes() formats kilobytes
      ✓ formatBytes() formats megabytes (1 ms)
      ✓ formatBytes() formats gigabytes
      ✓ formatBytes() rounds to 2 decimal places (1 ms)
      ✓ formatBytes() handles edge cases
    Cache Management
      ✓ getCacheStats() returns cache statistics (2 ms)
      ✓ getCacheStats() handles errors gracefully (9 ms)
      ✓ clearExpiredCache() returns count of cleared files (79 ms)
      ✓ clearAllCache() returns count of cleared files (4 ms)
    Image Retrieval
      ✓ getOriginalImage() fetches from storage
      ✓ getOriginalImage() detects content type correctly
    Edge Cases
      ✓ handles null dimensions in validateDimensions (1 ms)
      ✓ handles undefined dimensions in validateDimensions (1 ms)
      ✓ formatBytes handles very large numbers
      ✓ getCacheKey handles special characters in path (1 ms)
      ✓ getContentType handles paths without extension
      ✓ getContentType handles multiple dots in filename
      ✓ getAllowedSizes returns copy of sizes array (1 ms)
    Configuration Access
      ✓ cache directory is accessible
      ✓ cache TTL is accessible
      ✓ max dimensions are accessible (1 ms)
      ✓ allowed sizes array is accessible

PASS tests/unit/Validation/Validator.test.js
  Validator
    validate()
      ✓ should validate valid data against schema (26 ms)
      ✓ should return errors for invalid data (3 ms)
      ✓ should format multiple errors (3 ms)
      ✓ should strip unknown fields (2 ms)
      ✓ should validate nested objects (2 ms)
      ✓ should format nested validation errors with dot notation (2 ms)
      ✓ should validate arrays (1 ms)
      ✓ should return error for invalid array items (1 ms)
    middleware()
      ✓ should create validation middleware (18 ms)
      ✓ should call next() for valid data (4 ms)
      ✓ should return 422 error for invalid data (3 ms)
      ✓ should validate data from body, query, and params (2 ms)
      ✓ should update req.body with validated data (1 ms)
      ✓ should include validation errors in response (2 ms)
    make()
      ✓ should create Joi schema from rules
      ✓ should create usable validation schema (1 ms)
    Common Validation Rules
      ✓ should have string rule
      ✓ should have number rule (12 ms)
      ✓ should have boolean rule
      ✓ should have email rule (10 ms)
      ✓ should have uuid rule (1 ms)
      ✓ should have date rule (1 ms)
      ✓ should have array rule (1 ms)
      ✓ should have object rule (1 ms)
      ✓ should have min rule with limit (1 ms)
      ✓ should have max rule with limit
      ✓ should have pattern rule (1 ms)
    Integration
      ✓ should work with complex validation scenario (3 ms)
      ✓ should handle validation with custom error messages (23 ms)

PASS tests/unit/Services/Upload/SecurityScanner.test.js
  SecurityScanner
    Constructor
      ✓ should initialize with app instance (2 ms)
    scan()
      ✓ should pass scan for clean JPEG file (1 ms)
      ✓ should pass scan for clean PNG file (4 ms)
      ✓ should throw SecurityError for dangerous extension (4 ms)
      ✓ should throw SecurityError with multiple errors (2 ms)
      ✓ should throw SecurityError for file signature mismatch (2 ms)
      ✓ should throw SecurityError for executable content (1 ms)
      ✓ should throw SecurityError for oversized file (1 ms)
      ✓ should run custom scanner if configured (1 ms)
    checkFileSignature()
      ✓ should detect JPEG signature correctly (1 ms)
      ✓ should detect PNG signature correctly
      ✓ should detect GIF signature correctly (1 ms)
      ✓ should detect PDF signature correctly (20 ms)
      ✓ should add error for signature mismatch (1 ms)
      ✓ should skip validation if no extension (1 ms)
      ✓ should skip validation if detection fails (1 ms)
    detectFileType()
      ✓ should detect JPEG from magic bytes
      ✓ should detect PNG from magic bytes
      ✓ should detect GIF from magic bytes
      ✓ should detect PDF from magic bytes
      ✓ should detect ZIP from magic bytes (1 ms)
      ✓ should detect MP3 from magic bytes (ID3)
      ✓ should return null for unknown file type
      ✓ should return null for buffer too small (1 ms)
    checkDangerousExtensions()
      ✓ should detect .exe extension
      ✓ should detect .php extension (1 ms)
      ✓ should detect .sh extension
      ✓ should detect .js extension
      ✓ should detect .svg extension (1 ms)
      ✓ should allow safe extensions
      ✓ should be case-insensitive
    checkExecutableContent()
      ✓ should detect script tags (1 ms)
      ✓ should detect javascript: protocol
      ✓ should detect onerror attribute
      ✓ should detect PHP code (1 ms)
      ✓ should detect Windows executable (MZ header)
      ✓ should detect Linux executable (ELF header) (1 ms)
      ✓ should allow clean content (1 ms)
    checkSizeBomb()
      ✓ should reject files exceeding max size
      ✓ should allow files within size limit
      ✓ should use default max size if not configured (1 ms)
    isArchive()
      ✓ should identify ZIP as archive
      ✓ should identify RAR as archive
      ✓ should identify 7z as archive (1 ms)
      ✓ should identify GZIP as archive
      ✓ should identify TAR as archive
      ✓ should not identify image as archive (1 ms)
    getExtension()
      ✓ should extract .jpg extension
      ✓ should extract .png extension
      ✓ should return lowercase extension (1 ms)
      ✓ should handle multiple dots
      ✓ should return empty string for no extension
      ✓ should return empty string for null filename (1 ms)
    sanitizeFilename()
      ✓ should remove path traversal attempts
      ✓ should remove forward slashes (1 ms)
      ✓ should remove backslashes (1 ms)
      ✓ should remove null bytes
      ✓ should remove control characters
      ✓ should limit filename length to 255 characters (1 ms)
      ✓ should preserve extension when truncating
      ✓ should allow safe filenames unchanged
    SecurityError
      ✓ should create error with message
      ✓ should create error with errors array (1 ms)
      ✓ should default errors to empty array (18 ms)
      ✓ should be instance of Error

PASS tests/unit/Services/SMS/SmsManager.test.js
  SmsManager
    Constructor
      ✓ should initialize with app instance (4 ms)
      ✓ should create separate instances for different apps
    driver()
      ✓ should return default driver when no name provided (1 ms)
      ✓ should cache driver instances (1 ms)
      ✓ should create different instances for different driver names (1 ms)
    resolve()
      ✓ should throw error when driver is not configured (15 ms)
      ✓ should use custom creator when available (1 ms)
      ✓ should throw error for unsupported driver (2 ms)
    Driver Creation Methods
      ✓ should have createTwilioDriver method
      ✓ should have createAwsSnsDriver method
      ✓ should have createTwofactorDriver method (1 ms)
      ✓ should have createVonageDriver method
      ✓ should have createLogDriver method (1 ms)
      ✓ should follow naming convention for driver methods
    extend()
      ✓ should register custom creator
      ✓ should allow multiple custom creators
      ✓ should support fluent interface (1 ms)
    getConfig()
      ✓ should retrieve driver configuration
      ✓ should return undefined for nonexistent driver
      ✓ should return default value when drivers not configured
    getDefaultDriver()
      ✓ should return configured default driver (1 ms)
      ✓ should return log as fallback default
    capitalize()
      ✓ should capitalize first letter (1 ms)
      ✓ should handle single character
      ✓ should handle already capitalized
      ✓ should handle empty string (1 ms)
    send()
      ✓ should proxy to default driver (2 ms)
      ✓ should pass through all SMS options (1 ms)
    sendOtp()
      ✓ should send OTP with default settings (1 ms)
      ✓ should use custom app name and expiry minutes (2 ms)
      ✓ should support custom from number (1 ms)
    sendVerificationCode()
      ✓ should send verification code with default app name (1 ms)
      ✓ should use custom app name
      ✓ should support custom from number (1 ms)
    notify()
      ✓ should send notification message (1 ms)
      ✓ should support custom from number
    availableDrivers()
      ✓ should return configured drivers (1 ms)
      ✓ should include custom creators (1 ms)
      ✓ should deduplicate driver names (1 ms)
      ✓ should return empty array when no drivers configured
    Integration Scenarios
      ✓ should support multiple drivers simultaneously (1 ms)
      ✓ should allow custom driver to override built-in (1 ms)
      ✓ should handle driver creation errors gracefully (15 ms)
      ✓ should resolve correct method name for driver (1 ms)
      ✓ should chain helper methods correctly (1 ms)

PASS tests/unit/Auth/AuthManager.test.js
  AuthManager
    Constructor
      ✓ should initialize with app (3 ms)
    Guard Management
      ✓ should get default guard name (2 ms)
      ✓ should get guard config (2 ms)
      ✓ should manage guards cache
      ✓ should throw error for undefined guard (4 ms)
    Driver Resolution
      ✓ should have createSessionDriver method (1 ms)
      ✓ should have createTokenDriver method
      ✓ should throw error for invalid driver (2 ms)
      ✓ should use custom driver creator
    User Provider Creation
      ✓ should have createModelProvider method (1 ms)
      ✓ should return null for no provider (1 ms)
      ✓ should throw error for undefined provider (21 ms)
      ✓ should have createDatabaseProvider method (4 ms)
      ✓ should throw error for invalid provider driver (2 ms)
    Configuration Access
      ✓ should get guard config (1 ms)
      ✓ should get provider config (1 ms)
      ✓ should get default driver name (1 ms)
    Default Guard Setting
      ✓ should set up shouldUse method
    Helper Methods
      ✓ should convert to StudlyCase
    Proxy Methods
      ✓ should have proxy methods defined (8 ms)
    Edge Cases
      ✓ should handle custom creators registration (1 ms)
      ✓ should handle resolver updates (1 ms)
      ✓ should handle guards Map operations (1 ms)

PASS tests/unit/Support/Helpers/JwtHelper.test.js (6.014 s)
  JwtHelper
    generateToken
      ✓ should generate a valid JWT token (9 ms)
      ✓ should include expiration time (1 ms)
      ✓ should support custom claims (4 ms)
    verifyToken
      ✓ should verify a valid token (2 ms)
      ✓ should reject invalid tokens (3 ms)
      ✓ should reject tokens with wrong secret (1 ms)
      ✓ should verify issuer if provided (1 ms)
    decodeToken
      ✓ should decode token without verification (1 ms)
      ✓ should throw on invalid token format (2 ms)
      ✓ should throw on null token
    isTokenExpired
      ✓ should detect non-expired tokens
      ✓ should detect expired tokens (1101 ms)
      ✓ should handle tokens without expiration (1 ms)
      ✓ should return true for invalid tokens
    getTokenExpiration
      ✓ should get expiration date (1 ms)
      ✓ should return null for tokens without expiration
      ✓ should return null for invalid tokens (1 ms)
    refreshToken
      ✓ should create new token from existing (1103 ms)
      ✓ should not include old iat/exp claims (1101 ms)
    generateTokenPair
      ✓ should generate access and refresh tokens (2 ms)
      ✓ should have different expiration times (1 ms)
      ✓ should mark refresh token with type (1 ms)
    generateJti
      ✓ should generate unique JWT IDs (1 ms)
    extractTokenFromHeader
      ✓ should extract token from Bearer header
      ✓ should return null for invalid format (1 ms)
    createAuthHeader
      ✓ should create Bearer authorization header
    isValidTokenStructure
      ✓ should validate token structure
      ✓ should reject invalid structures (1 ms)
    getTokenAge
      ✓ should calculate token age (101 ms)
      ✓ should return null for invalid tokens (1 ms)
    getRemainingLifetime
      ✓ should calculate remaining lifetime
      ✓ should return 0 for expired tokens (1101 ms)
      ✓ should return null for tokens without expiration
    JwtHelper class
      ✓ should generate tokens
      ✓ should verify tokens (1 ms)
      ✓ should decode tokens
      ✓ should check expiration (1 ms)
      ✓ should refresh tokens (1 ms)
      ✓ should generate token pairs (1 ms)
      ✓ should provide static methods

PASS tests/unit/Exceptions/ErrorTypes.test.js
  ErrorTypes
    ValidationError
      ✓ should create validation error with 422 status (5 ms)
      ✓ should accept custom message (1 ms)
    BadRequestError
      ✓ should create bad request error with 400 status (1 ms)
      ✓ should accept custom message and errors
    UnauthorizedError
      ✓ should create unauthorized error with 401 status (17 ms)
      ✓ should accept custom message
    ForbiddenError
      ✓ should create forbidden error with 403 status (1 ms)
      ✓ should accept custom message (1 ms)
    NotFoundError
      ✓ should create not found error with 404 status (1 ms)
      ✓ should accept custom message (1 ms)
    ConflictError
      ✓ should create conflict error with 409 status (1 ms)
      ✓ should accept custom message
    TooManyRequestsError
      ✓ should create too many requests error with 429 status (1 ms)
      ✓ should accept custom message (1 ms)
    InternalServerError
      ✓ should create internal server error with 500 status (1 ms)
      ✓ should accept custom message
    ServiceUnavailableError
      ✓ should create service unavailable error with 503 status (3 ms)
      ✓ should accept custom message (7 ms)
    DatabaseError
      ✓ should create database error with 500 status (1 ms)
      ✓ should accept custom message and errors
    AuthenticationError
      ✓ should create authentication error with 401 status (1 ms)
      ✓ should accept custom message
    AuthorizationError
      ✓ should create authorization error with 403 status (1 ms)
      ✓ should accept custom message
    All error types
      ✓ should all be operational errors by default (2 ms)
      ✓ should all have proper JSON serialization (2 ms)

PASS tests/unit/Payment/PaymentGateways.test.js
  Payment Gateways
    PaymentGateway Base Class
      ✓ should not allow direct instantiation (7 ms)
      ✓ should provide common utility methods (1 ms)
    PhonePeGateway
      ✓ should create payment with valid config (2 ms)
      ✓ should generate checksum correctly (6 ms)
      ✓ should verify payment status (1 ms)
      ✓ should convert amount to paise
    RazorpayGateway
      ✓ should create order (1 ms)
      ✓ should verify payment signature
      ✓ should handle webhook validation (1 ms)
    StripeGateway
      ✓ should create payment intent
      ✓ should verify payment intent
      ✓ should create checkout session
      ✓ should convert amount to cents (1 ms)
    PaymentManager
      ✓ should switch between gateways (1 ms)
      ✓ should use default gateway
      ✓ should proxy payment methods

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByIP (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:109:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:172:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByIP (framework/Http/Middleware/RateLimiter.js:109:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:172:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByIP (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:109:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:177:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByIP (framework/Http/Middleware/RateLimiter.js:109:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:177:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByIP (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:109:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:187:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByIP (framework/Http/Middleware/RateLimiter.js:109:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:187:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByIP (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:109:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:192:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByIP (framework/Http/Middleware/RateLimiter.js:109:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:192:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByUser (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:127:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:200:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByUser (framework/Http/Middleware/RateLimiter.js:127:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:200:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByUser (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:127:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:205:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByUser (framework/Http/Middleware/RateLimiter.js:127:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:205:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByUser (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:127:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:210:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByUser (framework/Http/Middleware/RateLimiter.js:127:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:210:26)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByUser (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:127:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:221:26)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByUser (framework/Http/Middleware/RateLimiter.js:127:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:221:26)

PASS tests/unit/Patterns/RepositoryFactory.test.js
  BaseRepository
    constructor
      ✓ initializes with model (2 ms)
    findAll
      ✓ returns all records without options (2 ms)
      ✓ applies where criteria (1 ms)
      ✓ applies orderBy with default direction (1 ms)
      ✓ applies orderBy with custom direction
      ✓ applies limit
      ✓ applies offset (1 ms)
      ✓ applies all options together (1 ms)
    findById
      ✓ returns record when found (35 ms)
      ✓ returns null when not found
      ✓ handles string ID
    findOne
      ✓ returns first matching record (1 ms)
      ✓ returns null when not found (2 ms)
      ✓ applies multiple criteria (1 ms)
    create
      ✓ creates new record (1 ms)
      ✓ returns record with generated ID
    update
      ✓ updates existing record
      ✓ throws error when record not found (2 ms)
      ✓ preserves unchanged fields (1 ms)
    delete
      ✓ deletes existing record
      ✓ throws error when record not found
    count
      ✓ counts all records without criteria (1 ms)
      ✓ counts records with criteria
      ✓ applies multiple criteria
    exists
      ✓ returns true when records exist (1 ms)
      ✓ returns false when no records exist
    getModel
      ✓ returns the model instance
  RepositoryFactory
    constructor
      ✓ initializes empty containers
    register
      ✓ registers repository creator (1 ms)
      ✓ overwrites existing registration
    make
      ✓ creates repository instance (1 ms)
      ✓ caches repository instance
      ✓ throws error for unregistered repository (2 ms)
      ✓ creates different instances for different repositories (1 ms)
    has
      ✓ returns true for registered repository
      ✓ returns false for unregistered repository
    forget
      ✓ removes repository creator (1 ms)
      ✓ removes cached instance
      ✓ does not throw for non-existent repository (1 ms)
    clear
      ✓ removes all repositories and creators (1 ms)
      ✓ can register repositories after clear
    integration scenarios
      ✓ supports custom repository classes (1 ms)
      ✓ supports dependency injection
      ✓ supports multiple model repositories (1 ms)
  createRepositoryFactory
    ✓ creates new factory instance
    ✓ creates independent instances
  repositoryFactory (global instance)
    ✓ is a RepositoryFactory instance
    ✓ can be used as global container (1 ms)
    ✓ persists across imports

PASS tests/unit/Config/Repository.test.js
  ConfigRepository
    Constructor
      ✓ should initialize with empty items (4 ms)
      ✓ should initialize with provided items (1 ms)
      ✓ should support nested object initialization (3 ms)
    has()
      ✓ should return true for existing keys (1 ms)
      ✓ should return false for non-existing keys
      ✓ should work with nested keys (1 ms)
      ✓ should handle null values correctly (1 ms)
    get()
      ✓ should retrieve values with dot notation
      ✓ should return default value for non-existing keys (1 ms)
      ✓ should return null as default when no default provided
      ✓ should handle nested objects (1 ms)
      ✓ should return entire nested object when key points to object
      ✓ should handle array of keys by calling getMany (1 ms)
    getMany()
      ✓ should retrieve multiple values
      ✓ should use default values for missing keys
      ✓ should handle empty array (1 ms)
    set()
      ✓ should set values with dot notation
      ✓ should set multiple values with object (13 ms)
      ✓ should overwrite existing values (1 ms)
      ✓ should create nested structures
    prepend()
      ✓ should prepend value to array (1 ms)
      ✓ should create array if key does not exist
      ✓ should throw error if value is not an array (9 ms)
    push()
      ✓ should push value to array (6 ms)
      ✓ should create array if key does not exist
      ✓ should throw error if value is not an array (5 ms)
      ✓ should handle multiple pushes (1 ms)
    all()
      ✓ should return all configuration items (1 ms)
      ✓ should return shallow copy of items (not deep copy)
      ✓ should return empty object when no items (26 ms)
    merge()
      ✓ should merge new configuration items
      ✓ should overwrite existing keys during merge (2 ms)
      ✓ should handle empty merge (3 ms)
    clear()
      ✓ should clear all configuration items (1 ms)
      ✓ should allow setting new items after clear
    Integration Scenarios
      ✓ should handle complex nested configuration (1 ms)
      ✓ should support array operations on nested arrays
      ✓ should handle mixed data types (1 ms)
      ✓ should support fluent configuration building

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByIP (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:109:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:239:25)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByIP (framework/Http/Middleware/RateLimiter.js:109:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:239:25)

  console.error
    ValidationError: Custom keyGenerator appears to use request IP without calling the ipKeyGenerator helper function for IPv6 addresses. This could allow IPv6 users to bypass limits. See https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/ for more information.
        at Object.keyGeneratorIpFallback (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:608:13)
        at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:651:22)
        at parseOptions (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:721:16)
        at rateLimit (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/express-rate-limit/dist/index.mjs:802:18)
        at rateLimiter (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:44:10)
        at rateLimiterByUser (/Users/rishi/Desktop/work/vasuzex-v2/framework/Http/Middleware/RateLimiter.js:127:10)
        at Object.<anonymous> (/Users/rishi/Desktop/work/vasuzex-v2/tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:240:27)
        at Promise.then.completed (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:103:5)
        at _runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/rishi/Desktop/work/vasuzex-v2/node_modules/jest-runner/build/testWorker.js:106:12) {
      code: 'ERR_ERL_KEY_GEN_IPV6',
      help: 'https://express-rate-limit.github.io/ERR_ERL_KEY_GEN_IPV6/'
    }

      42 |   };
      43 |
    > 44 |   return rateLimit({ ...defaults, ...options });
         |          ^
      45 | }
      46 |
      47 | /**

      at Object.wrappedValidations.<computed> [as keyGeneratorIpFallback] (node_modules/express-rate-limit/dist/index.mjs:657:24)
      at parseOptions (node_modules/express-rate-limit/dist/index.mjs:721:16)
      at rateLimit (node_modules/express-rate-limit/dist/index.mjs:802:18)
      at rateLimiter (framework/Http/Middleware/RateLimiter.js:44:10)
      at rateLimiterByUser (framework/Http/Middleware/RateLimiter.js:127:10)
      at Object.<anonymous> (tests/unit/Http/Middleware/RateLimiterMiddleware.test.js:240:27)

PASS tests/unit/Http/Middleware/RateLimiterMiddleware.test.js
  RateLimiter Middleware
    rateLimiter()
      ✓ should return a function (21 ms)
      ✓ should create middleware with default options (2 ms)
      ✓ should accept custom options (1 ms)
      ✓ should merge custom options with defaults (1 ms)
      ✓ should have standardHeaders enabled by default (1 ms)
      ✓ should handle custom handler for errors (14 ms)
    strictRateLimiter()
      ✓ should return a function (1 ms)
      ✓ should use strict defaults (5 req/15min) (1 ms)
      ✓ should accept custom options that override defaults (1 ms)
      ✓ should use custom message for strict limiting (1 ms)
    apiRateLimiter()
      ✓ should return a function (1 ms)
      ✓ should use API defaults (60 req/minute) (1 ms)
      ✓ should accept custom API rate limits (1 ms)
      ✓ should use API-specific message (1 ms)
    bruteForceLimiter()
      ✓ should return a function (1 ms)
      ✓ should use brute force defaults (10 req/hour)
      ✓ should skip successful requests by default (16 ms)
      ✓ should accept custom brute force options (1 ms)
    rateLimiterByIP()
      ✓ should return a function (168 ms)
      ✓ should use IP as key (16 ms)
      ✓ should accept custom options (26 ms)
      ✓ should handle requests without IP (3 ms)
    rateLimiterByUser()
      ✓ should return a function (12 ms)
      ✓ should use user ID as key when authenticated (3 ms)
      ✓ should fall back to IP when not authenticated (2 ms)
      ✓ should accept custom options (3 ms)
    Integration
      ✓ should work with Express middleware chain
      ✓ should allow chaining multiple rate limiters (74 ms)

PASS tests/unit/Patterns/ServiceFactory.test.js
  ServiceFactory
    constructor
      ✓ initializes empty containers (8 ms)
    register
      ✓ registers a service
      ✓ registers a singleton when flag is true (1 ms)
      ✓ overwrites existing service (1 ms)
    singleton
      ✓ registers service as singleton
      ✓ returns same instance on multiple make calls (2 ms)
      ✓ does not recreate singleton if already instantiated (1 ms)
    alias
      ✓ registers an alias
      ✓ resolves service through alias (1 ms)
      ✓ supports multiple aliases for same service
    make
      ✓ creates service instance (1 ms)
      ✓ creates new instance each time for non-singletons
      ✓ passes factory instance to creator
      ✓ throws error for unregistered service (10 ms)
      ✓ resolves singleton that is already instance
      ✓ handles dependency injection through creator (1 ms)
    has
      ✓ returns true for registered service
      ✓ returns true for registered singleton (1 ms)
      ✓ returns true for aliased service
      ✓ returns false for unregistered service (1 ms)
    forget
      ✓ removes service from container (1 ms)
      ✓ removes singleton from container
      ✓ removes associated aliases (1 ms)
      ✓ does not throw for non-existent service
    clear
      ✓ removes all services (1 ms)
      ✓ can register services after clear
    getServiceNames
      ✓ returns empty array when no services registered (1 ms)
      ✓ returns all service names (1 ms)
      ✓ does not include aliases
    integration scenarios
      ✓ supports service factory pattern (93 ms)
      ✓ supports lazy loading of services
      ✓ supports service replacement for testing (3 ms)
  createServiceFactory
    ✓ creates new factory instance (1 ms)
    ✓ creates independent instances (1 ms)
  serviceFactory (global instance)
    ✓ is a ServiceFactory instance
    ✓ can be used as global container
    ✓ persists across imports (1 ms)

PASS tests/unit/Http/Middleware/Authorize.test.js
  Authorize Middleware
    Authorize Class
      ✓ should initialize with single ability (41 ms)
      ✓ should initialize with multiple abilities
      ✓ should initialize with options (1 ms)
      ✓ should throw ForbiddenError if user not authenticated (3 ms)
      ✓ should throw error if Gate not available
      ✓ should use global Gate if app.locals.Gate not available (1 ms)
      ✓ should set current user on Gate (1 ms)
      ✓ should allow request when user has required ability (1 ms)
      ✓ should throw ForbiddenError when user lacks ability
      ✓ should allow request when user has all required abilities (requireAll)
      ✓ should throw ForbiddenError when user lacks one of required abilities (requireAll) (29 ms)
      ✓ should allow request when user has at least one ability (requireAll: false) (6 ms)
      ✓ should throw ForbiddenError when user lacks all abilities (requireAll: false)
      ✓ should use custom error message (1 ms)
      ✓ should pass resource to Gate.allows() (4 ms)
      ✓ should return middleware function (1 ms)
    authorize() factory
      ✓ should create middleware with single ability
      ✓ should create middleware with multiple abilities (1 ms)
      ✓ should create middleware with options (1 ms)
    requireRole() middleware
      ✓ should allow user with required role
      ✓ should allow user with required role (array format)
      ✓ should throw ForbiddenError when user lacks role (1 ms)
      ✓ should allow user with all required roles (requireAll)
      ✓ should throw ForbiddenError when user lacks one role (requireAll) (1 ms)
      ✓ should allow user with at least one role (requireAll: false)
      ✓ should throw ForbiddenError if user not authenticated (1 ms)
      ✓ should use custom error message (1 ms)
    requirePermission() middleware
      ✓ should allow user with required permission
      ✓ should throw ForbiddenError when user lacks permission (1 ms)
      ✓ should allow user with all required permissions (requireAll)
      ✓ should throw ForbiddenError when user lacks one permission (requireAll)
      ✓ should allow user with at least one permission (requireAll: false)
      ✓ should throw ForbiddenError if user not authenticated (1 ms)
      ✓ should use custom error message

PASS tests/unit/Foundation/BaseServer.test.js
  BaseServer
    Constructor
      ✓ should initialize with default options (30 ms)
      ✓ should initialize with custom options (12 ms)
      ✓ should prioritize options.port over env.APP_PORT (1 ms)
      ✓ should use env.APP_PORT when no port option provided (1 ms)
      ✓ should use default port 3000 when no port configured (1 ms)
    validateConfig()
      ✓ should execute without error by default (1 ms)
      ✓ should be overridable in subclass (5 ms)
    initializeServices()
      ✓ should execute without error by default (1 ms)
      ✓ should be overridable in subclass (1 ms)
    createApp()
      ✓ should throw error when not implemented (25 ms)
      ✓ should be implementable in subclass (1 ms)
    start()
      ✓ should start server successfully with BaseApp instance (3 ms)
      ✓ should start server with plain Express app (no getExpress method) (1 ms)
      ✓ should call validateConfig before starting
      ✓ should call initializeServices before creating app (1 ms)
      ✓ should throw error and log when validateConfig fails (1 ms)
      ✓ should throw error and log when initializeServices fails (1 ms)
      ✓ should throw error and log when createApp fails (1 ms)
      ✓ should execute lifecycle methods in correct order (1 ms)
    stop()
      ✓ should stop running server (31 ms)
      ✓ should resolve when server stops (1 ms)
      ✓ should do nothing when server not running
    getServer()
      ✓ should return null when server not started
      ✓ should return server instance after start (1 ms)
    getApp()
      ✓ should return null when app not created
      ✓ should return app instance after start (1 ms)
    Integration scenarios
      ✓ should handle complete lifecycle: start -> stop (1 ms)
      ✓ should support multiple start/stop cycles

PASS tests/unit/Console/Schedule.test.js
  Schedule
    Constructor
      ✓ should initialize with empty events array (5 ms)
      ✓ should extend EventEmitter (4 ms)
    command()
      ✓ should schedule a command (2 ms)
      ✓ should schedule command with args
      ✓ should return scheduled event for chaining (1 ms)
    call()
      ✓ should schedule a callback
      ✓ should schedule callback with args (1 ms)
    exec()
      ✓ should schedule an exec command (1 ms)
    dueEvents()
      ✓ should return empty array when no events
      ✓ should filter due events (1 ms)
      ✓ should exclude non-due events
    run()
      ✓ should run all due events (1 ms)
      ✓ should return count of executed events
      ✓ should not run non-due events (1 ms)
    ScheduledEvent
      ✓ should have default cron expression
      ✓ should allow custom cron expression
      ✓ should support method chaining (1 ms)
    Multiple Events
      ✓ should handle multiple scheduled events
      ✓ should maintain event order

PASS tests/unit/Support/Helpers/DebugHelper.test.js
  DebugHelper
    inspect()
      ✓ should print value and return it (41 ms)
      ✓ should print value with label (2 ms)
      ✓ should handle null values (2 ms)
      ✓ should handle undefined values (1 ms)
      ✓ should handle complex objects (28 ms)
      ✓ should handle arrays (1 ms)
      ✓ should be chainable (3 ms)
    dd()
      ✓ should print value and exit process (4 ms)
      ✓ should print value with label (1 ms)
      ✓ should use custom exit code (18 ms)
      ✓ should handle complex nested objects (1 ms)
      ✓ should show caller information (1 ms)
    DebugHelper class
      ✓ should expose inspect as static method (1 ms)
      ✓ should expose dd as static method
      ✓ should work with class methods (2 ms)
    Edge Cases
      ✓ should handle circular references (1 ms)
      ✓ should handle Error objects (1 ms)
      ✓ should handle Promises (1 ms)
      ✓ should handle Functions (2 ms)
      ✓ should handle large arrays (16 ms)
      ✓ should handle Symbols (2 ms)
      ✓ should handle Map and Set (2 ms)
      ✓ should handle Buffer (1 ms)

PASS tests/unit/Support/Helpers/ValidationHelper.test.js
  ValidationHelper
    isValidEmail
      ✓ should validate correct email addresses (23 ms)
      ✓ should reject invalid email addresses (1 ms)
      ✓ should handle edge cases (1 ms)
    isValidUUID
      ✓ should validate UUIDs (1 ms)
      ✓ should validate UUID v4 (1 ms)
      ✓ should reject invalid UUIDs (1 ms)
      ✓ should handle edge cases
    isValidObjectId
      ✓ should validate MongoDB ObjectIds (1 ms)
      ✓ should reject invalid ObjectIds (1 ms)
      ✓ should handle edge cases
    isValidPhone
      ✓ should validate international phone numbers (1 ms)
      ✓ should handle phone with formatting
      ✓ should reject invalid phone numbers (1 ms)
      ✓ should handle edge cases
    isValidIndianPhone
      ✓ should validate Indian phone numbers (1 ms)
      ✓ should handle formatting
      ✓ should reject invalid Indian numbers (1 ms)
    validatePassword
      ✓ should validate strong passwords (1 ms)
      ✓ should enforce minimum length (1 ms)
      ✓ should enforce uppercase requirement
      ✓ should enforce lowercase requirement (1 ms)
      ✓ should enforce number requirement
      ✓ should enforce special character requirement
      ✓ should handle edge cases (1 ms)
    isValidURL
      ✓ should validate URLs (1 ms)
      ✓ should reject invalid URLs
      ✓ should handle edge cases
    isValidIP
      ✓ should validate IPv4 addresses (26 ms)
      ✓ should validate IPv6 addresses (1 ms)
      ✓ should reject invalid IP addresses (1 ms)
      ✓ should handle edge cases (1 ms)
    isValidCreditCard
      ✓ should validate credit card numbers using Luhn algorithm (1 ms)
      ✓ should reject invalid credit card numbers
      ✓ should handle edge cases (1 ms)
    isValidDate
      ✓ should validate date strings (1 ms)
      ✓ should reject invalid dates
      ✓ should handle edge cases
    isAlphanumeric
      ✓ should validate alphanumeric strings
      ✓ should reject non-alphanumeric strings (1 ms)
      ✓ should handle edge cases
    isNumeric
      ✓ should validate numeric strings (3 ms)
      ✓ should reject non-numeric strings
      ✓ should handle edge cases (1 ms)
    hasValidLength
      ✓ should validate string length (1 ms)
      ✓ should reject invalid lengths
      ✓ should handle edge cases
    ValidationHelper class
      ✓ should provide static methods (1 ms)

PASS tests/unit/Support/RateLimiter.test.js
  RateLimiter
    Constructor
      ✓ should initialize with cache instance (3 ms)
    tooManyAttempts()
      ✓ should return true when attempts exceed max (1 ms)
      ✓ should return false when attempts under max
      ✓ should return false when no attempts (1 ms)
    hit()
      ✓ should increment attempts (13 ms)
      ✓ should set expiry on first hit (1 ms)
      ✓ should not set expiry on subsequent hits
    attempts()
      ✓ should return attempt count (1 ms)
      ✓ should return 0 when no attempts (1 ms)
    resetAttempts()
      ✓ should clear attempts (1 ms)
    retriesLeft()
      ✓ should calculate retries left (1 ms)
      ✓ should return 0 when no retries left
      ✓ should not return negative values (1 ms)
    clear()
      ✓ should clear attempts and timer (1 ms)
    availableIn()
      ✓ should return seconds until available (1 ms)
      ✓ should return 0 when no timer set (1 ms)
      ✓ should return 0 when timer expired
    attempt()
      ✓ should execute callback within rate limit (8 ms)
      ✓ should return false when rate limit exceeded
    limiterKey()
      ✓ should generate rate limiter key (1 ms)
      ✓ should handle different identifiers (1 ms)
    for() middleware
      ✓ should create middleware function
      ✓ should allow request within rate limit (1 ms)
      ✓ should block request when rate limit exceeded (2 ms)
      ✓ should set rate limit headers (2 ms)

PASS tests/unit/Exceptions/asyncHandler.test.js
  asyncHandler
    asyncHandler
      ✓ should handle successful async function (3 ms)
      ✓ should catch errors and pass to next (1 ms)
      ✓ should handle rejected promises
      ✓ should pass through request, response, and next (6 ms)
      ✓ should handle errors thrown inside async handler (17 ms)
      ✓ should handle async functions that call next
    asyncMiddleware
      ✓ should handle successful async middleware (1 ms)
      ✓ should catch middleware errors
      ✓ should work identically to asyncHandler (1 ms)
    catchAsync
      ✓ should be an alias for asyncHandler
      ✓ should work the same as asyncHandler (1 ms)
    real-world usage examples
      ✓ should handle database queries (1 ms)
      ✓ should handle multiple async operations (1 ms)
      ✓ should preserve error stack trace (3 ms)
    edge cases
      ✓ should handle null/undefined returns
      ✓ should handle functions that return non-promises
      ✓ should handle already resolved promises

PASS tests/unit/Support/Helpers/SanitizationHelper.test.js
  SanitizationHelper
    sanitizeString
      ✓ should remove HTML tags by default (2 ms)
      ✓ should preserve HTML if allowed
      ✓ should trim whitespace (1 ms)
      ✓ should convert case (1 ms)
      ✓ should remove special characters if requested
      ✓ should handle edge cases (1 ms)
    sanitizeEmail
      ✓ should sanitize email addresses (1 ms)
      ✓ should handle edge cases (1 ms)
    sanitizePhone
      ✓ should remove non-numeric characters except +
      ✓ should remove country code if requested (1 ms)
      ✓ should handle edge cases
    escapeHTML
      ✓ should escape HTML special characters (1 ms)
      ✓ should handle edge cases
    unescapeHTML
      ✓ should unescape HTML entities (1 ms)
      ✓ should handle edge cases
    sanitizeFilename
      ✓ should sanitize filenames (1 ms)
      ✓ should handle consecutive underscores
      ✓ should handle edge cases (1 ms)
    sanitizeURL
      ✓ should sanitize valid URLs
      ✓ should return empty string for invalid URLs (1 ms)
      ✓ should handle edge cases
    stripHTML
      ✓ should remove all HTML tags
      ✓ should decode HTML entities (1 ms)
      ✓ should handle edge cases
    sanitizeSQL
      ✓ should escape SQL special characters
      ✓ should remove dangerous SQL patterns
      ✓ should handle edge cases
    sanitizeObject
      ✓ should sanitize string values in objects (1 ms)
      ✓ should handle nested objects
      ✓ should handle arrays (3 ms)
      ✓ should preserve non-string values (1 ms)
      ✓ should handle edge cases
    removeNullBytes
      ✓ should remove null bytes
      ✓ should handle edge cases (2 ms)
    normalizeWhitespace
      ✓ should normalize whitespace (2 ms)
      ✓ should handle edge cases (1 ms)
    slugify
      ✓ should create URL-friendly slugs
      ✓ should remove special characters (1 ms)
      ✓ should handle multiple spaces and dashes
      ✓ should handle edge cases
    removeWhitespace
      ✓ should remove all whitespace (1 ms)
      ✓ should handle edge cases
    sanitizeJSON
      ✓ should sanitize valid JSON strings (1 ms)
      ✓ should return empty string for invalid JSON
      ✓ should handle edge cases (1 ms)
    SanitizationHelper class
      ✓ should provide static methods

PASS tests/unit/Http/Middleware/ValidateRequest.test.js
  ValidateRequest Middleware
    ValidateRequest class
      ✓ should create middleware instance (9 ms)
      ✓ should validate request body successfully (16 ms)
      ✓ should fail validation with errors (3 ms)
      ✓ should strip unknown fields by default (1 ms)
      ✓ should validate query parameters (4 ms)
      ✓ should validate route params (2 ms)
      ✓ should validate all sources (3 ms)
      ✓ should use custom error message (1 ms)
      ✓ should format Joi errors correctly (1 ms)
    validateRequest factory
      ✓ should create middleware function (1 ms)
      ✓ should validate request
    validateBody factory
      ✓ should validate request body
    validateQuery factory
      ✓ should validate query parameters (1 ms)
    validateParams factory
      ✓ should validate route parameters
    CommonValidators
      id validator
        ✓ should validate UUID (17 ms)
        ✓ should validate MongoDB ObjectId (1 ms)
        ✓ should fail for invalid ID (1 ms)
        ✓ should validate custom field name
      pagination validator
        ✓ should validate pagination params (1 ms)
        ✓ should use default values (1 ms)
        ✓ should enforce min/max limits (1 ms)
      email validator
        ✓ should validate email (1 ms)
        ✓ should fail for invalid email (1 ms)
      search validator
        ✓ should validate search query
        ✓ should validate with fields (2 ms)
        ✓ should fail for missing query

PASS tests/unit/Support/Arr.test.js
  Arr Utility
    get()
      ✓ should get nested value using dot notation (2 ms)
      ✓ should return default value for non-existent keys (1 ms)
      ✓ should return null as default when not specified (1 ms)
    set()
      ✓ should set nested value using dot notation (1 ms)
      ✓ should create intermediate objects
    has()
      ✓ should return true for existing keys
      ✓ should return false for non-existent keys
    flatten()
      ✓ should flatten array by default depth (2 ms)
      ✓ should flatten array by custom depth (1 ms)
    only()
      ✓ should return only specified keys (2 ms)
    except()
      ✓ should return all except specified keys
    pluck()
      ✓ should pluck values from array of objects (3 ms)
    groupBy()
      ✓ should group array by key
    chunk()
      ✓ should chunk array into smaller arrays
    unique()
      ✓ should return unique values
    wrap()
      ✓ should wrap non-array values (1 ms)
      ✓ should not wrap arrays

PASS tests/unit/Support/Helpers/PaginationHelper.test.js
  PaginationHelper - Functional API
    calculatePagination
      ✓ calculates pagination metadata correctly (4 ms)
      ✓ handles first page correctly (1 ms)
      ✓ handles last page correctly (1 ms)
      ✓ handles partial last page (1 ms)
      ✓ handles empty result set (1 ms)
      ✓ uses default values when not provided (1 ms)
      ✓ handles invalid page numbers
      ✓ handles invalid perPage values (1 ms)
      ✓ handles string inputs
      ✓ handles non-numeric inputs gracefully (1 ms)
    getOffset
      ✓ calculates offset for page 1
      ✓ calculates offset for page 2 (1 ms)
      ✓ calculates offset for page 5 with 20 per page
      ✓ handles invalid page (1 ms)
      ✓ uses default values
      ✓ handles string inputs
    getLimit
      ✓ returns requested limit
      ✓ enforces maximum limit
      ✓ handles invalid limit (1 ms)
      ✓ uses default values
      ✓ uses default maxLimit when not provided
      ✓ handles string inputs
    createPaginationResponse
      ✓ creates basic pagination response (1 ms)
      ✓ includes links when path provided (1 ms)
      ✓ sets prev link to null on first page
      ✓ sets next link to null on last page (1 ms)
      ✓ handles empty items array
    createCursorPaginationResponse
      ✓ creates cursor pagination response (1 ms)
      ✓ sets hasMore to false when no more items (1 ms)
      ✓ uses custom cursor field
      ✓ includes previous cursor
      ✓ handles empty items array (1 ms)
      ✓ handles invalid perPage
    getPageRange
      ✓ generates page range with delta 2
      ✓ generates range for first page
      ✓ generates range for last page
      ✓ handles small total pages without ellipsis
      ✓ handles single page
      ✓ handles two pages
      ✓ uses custom delta (1 ms)
      ✓ handles delta of 0
    validatePaginationParams
      ✓ validates correct parameters (1 ms)
      ✓ rejects page less than 1
      ✓ rejects perPage less than minPerPage (1 ms)
      ✓ rejects perPage greater than maxPerPage (1 ms)
      ✓ uses default values for invalid inputs
      ✓ uses custom defaults (1 ms)
      ✓ handles string inputs
    pageFromOffset
      ✓ calculates page from offset (1 ms)
      ✓ handles offset 0
      ✓ rounds up for partial pages (1 ms)
    getPageItems
      ✓ returns items for specified page
      ✓ returns first page items
      ✓ returns remaining items on last page (1 ms)
      ✓ returns empty array for out of range page
      ✓ handles empty array
    createSimplePagination
      ✓ creates simple pagination with items (1 ms)
      ✓ handles first page
      ✓ handles empty array (1 ms)
    mergePaginationQuery
      ✓ merges pagination params with existing query
      ✓ overwrites existing page and perPage (1 ms)
      ✓ handles empty query
      ✓ preserves other query parameters
    extractPaginationParams
      ✓ extracts pagination params from query (1 ms)
      ✓ uses default values when not present
      ✓ uses custom defaults
      ✓ enforces maximum limit
      ✓ handles invalid values
  PaginationHelper - Class API
    constructor
      ✓ creates instance with default options (1 ms)
      ✓ creates instance with custom options
      ✓ merges custom options with defaults (1 ms)
    calculate method
      ✓ calculates pagination metadata (1 ms)
      ✓ uses default page when not provided
      ✓ uses default perPage when not provided
    createResponse method
      ✓ creates pagination response (1 ms)
      ✓ uses default values when not provided (12 ms)
      ✓ accepts options for links
    createCursorResponse method
      ✓ creates cursor pagination response
      ✓ uses default perPage when not provided
    validate method
      ✓ validates pagination parameters (1 ms)
      ✓ uses helper options for validation
    extract method
      ✓ extracts pagination params from query
      ✓ uses helper defaults (1 ms)
      ✓ merges extract options with helper options
    static methods
      ✓ provides static getOffset
      ✓ provides static getLimit
      ✓ provides static getPageRange
      ✓ provides static pageFromOffset
      ✓ provides static getPageItems
      ✓ provides static mergePaginationQuery

Summary of all failing tests
FAIL tests/unit/Auth/Gate.test.js
  ● Gate › Policy-based Authorization › should find policy by model class

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      304 |       const result = await gate.check('create', [new Post()]);
      305 |
    > 306 |       expect(result).toBe(true);
          |                      ^
      307 |     });
      308 |
      309 |     it('should find policy by model name', async () => {

      at Object.<anonymous> (tests/unit/Auth/Gate.test.js:306:22)

  ● Gate › Edge Cases › should handle multiple after callbacks

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      534 |
      535 |       expect(after1).toHaveBeenCalled();
    > 536 |       expect(after2).toHaveBeenCalled();
          |                      ^
      537 |       expect(after3).toHaveBeenCalled();
      538 |       expect(result).toBe(false);
      539 |     });

      at Object.<anonymous> (tests/unit/Auth/Gate.test.js:536:22)

  ● Gate › Edge Cases › should handle policy method with arguments

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: "New Title"

      556 |       const result = await gate.check('update', [post, data]);
      557 |
    > 558 |       expect(result).toBe(true);
          |                      ^
      559 |     });
      560 |
      561 |     it('should handle denies as opposite of allows', async () => {

      at Object.<anonymous> (tests/unit/Auth/Gate.test.js:558:22)

FAIL tests/unit/Auth/TokenGuard.test.js
  ● TokenGuard › User Retrieval › should return null if no token

    TypeError: guard.user is not a function

      59 |       guard.request = { query: {}, body: {}, headers: {} };
      60 |
    > 61 |       const user = await guard.user();
         |                                ^
      62 |
      63 |       expect(user).toBeNull();
      64 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:61:32)

  ● TokenGuard › User Retrieval › should retrieve user by token from query

    TypeError: guard.user is not a function

      74 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      75 |
    > 76 |       const user = await guard.user();
         |                                ^
      77 |
      78 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      79 |         api_token: 'test-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:76:32)

  ● TokenGuard › User Retrieval › should retrieve user by token from body

    TypeError: guard.user is not a function

      92 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      93 |
    > 94 |       const user = await guard.user();
         |                                ^
      95 |
      96 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      97 |         api_token: 'body-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:94:32)

  ● TokenGuard › User Retrieval › should retrieve user by bearer token

    TypeError: guard.user is not a function

      110 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      111 |
    > 112 |       const user = await guard.user();
          |                                ^
      113 |
      114 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      115 |         api_token: 'bearer-token-123'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:112:32)

  ● TokenGuard › User Retrieval › should retrieve user by basic auth password

    TypeError: guard.user is not a function

      131 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      132 |
    > 133 |       const user = await guard.user();
          |                                ^
      134 |
      135 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      136 |         api_token: 'basic-password'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:133:32)

  ● TokenGuard › User Retrieval › should hash token when hash option is enabled

    TypeError: guard.user is not a function

      153 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      154 |
    > 155 |       const user = await guard.user();
          |                                ^
      156 |
      157 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      158 |         api_token: hashedToken

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:155:32)

  ● TokenGuard › User Retrieval › should prioritize query over body

    TypeError: guard.user is not a function

      171 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      172 |
    > 173 |       await guard.user();
          |                   ^
      174 |
      175 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      176 |         api_token: 'query-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:173:19)

  ● TokenGuard › User Retrieval › should prioritize bearer over basic auth

    TypeError: guard.user is not a function

      192 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      193 |
    > 194 |       await guard.user();
          |                   ^
      195 |
      196 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      197 |         api_token: 'bearer-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:194:19)

  ● TokenGuard › Validation › should hash token during validation when enabled

    TypeError: crypto.createHash is not a function

      82 |     const user = await this.provider.retrieveByCredentials({
      83 |       [this.storageKey]: this.hash 
    > 84 |         ? crypto.createHash('sha256').update(credentials[this.inputKey]).digest('hex')
         |                  ^
      85 |         : credentials[this.inputKey]
      86 |     });
      87 |

      at TokenGuard.validate (framework/Auth/Guards/TokenGuard.js:84:18)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:321:19)

  ● TokenGuard › User Management › should update cached user

    TypeError: guard.user is not a function

      347 |
      348 |       guard.setUser(user1);
    > 349 |       expect(await guard.user()).toBe(user1);
          |                          ^
      350 |
      351 |       guard.setUser(user2);
      352 |       expect(await guard.user()).toBe(user2);

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:349:26)

  ● TokenGuard › Authentication Checks › should return true when user is authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:376:34)

  ● TokenGuard › Authentication Checks › should return false when user is not authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:388:34)

  ● TokenGuard › Authentication Checks › should return false for guest when authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at TokenGuard.guest (framework/Auth/Guards/TokenGuard.js:118:25)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:402:34)

  ● TokenGuard › Authentication Checks › should return true for guest when not authenticated

    TypeError: this.user is not a function

      109 |    */
      110 |   async check() {
    > 111 |     return (await this.user()) !== null;
          |                        ^
      112 |   }
      113 |
      114 |   /**

      at TokenGuard.check (framework/Auth/Guards/TokenGuard.js:111:24)
      at TokenGuard.guest (framework/Auth/Guards/TokenGuard.js:118:25)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:414:34)

  ● TokenGuard › ID Retrieval › should return user ID when authenticated

    TypeError: this.user is not a function

      123 |    */
      124 |   async id() {
    > 125 |     const user = await this.user();
          |                             ^
      126 |     return user ? user.getAuthIdentifier() : null;
      127 |   }
      128 | }

      at TokenGuard.id (framework/Auth/Guards/TokenGuard.js:125:29)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:434:30)

  ● TokenGuard › ID Retrieval › should return null when not authenticated

    TypeError: this.user is not a function

      123 |    */
      124 |   async id() {
    > 125 |     const user = await this.user();
          |                             ^
      126 |     return user ? user.getAuthIdentifier() : null;
      127 |   }
      128 | }

      at TokenGuard.id (framework/Auth/Guards/TokenGuard.js:125:29)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:446:30)

  ● TokenGuard › Edge Cases › should handle request with null query

    TypeError: guard.user is not a function

      458 |       };
      459 |
    > 460 |       const user = await guard.user();
          |                                ^
      461 |
      462 |       expect(user).toBeNull();
      463 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:460:32)

  ● TokenGuard › Edge Cases › should handle request with null body

    TypeError: guard.user is not a function

      470 |       };
      471 |
    > 472 |       const user = await guard.user();
          |                                ^
      473 |
      474 |       expect(user).toBeNull();
      475 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:472:32)

  ● TokenGuard › Edge Cases › should handle request with null headers

    TypeError: guard.user is not a function

      482 |       };
      483 |
    > 484 |       const user = await guard.user();
          |                                ^
      485 |
      486 |       expect(user).toBeNull();
      487 |     });

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:484:32)

  ● TokenGuard › Edge Cases › should handle user without getAuthIdentifier method

    TypeError: this.user is not a function

      123 |    */
      124 |   async id() {
    > 125 |     const user = await this.user();
          |                             ^
      126 |     return user ? user.getAuthIdentifier() : null;
      127 |   }
      128 | }

      at TokenGuard.id (framework/Auth/Guards/TokenGuard.js:125:29)
      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:525:30)

  ● TokenGuard › Edge Cases › should handle multiple calls to user() with same result

    TypeError: guard.user is not a function

      537 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      538 |
    > 539 |       const user1 = await guard.user();
          |                                 ^
      540 |       const user2 = await guard.user();
      541 |       const user3 = await guard.user();
      542 |

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:539:33)

  ● TokenGuard › Edge Cases › should handle custom input and storage keys

    TypeError: guard.user is not a function

      559 |       mockProvider.retrieveByCredentials.mockResolvedValue(mockUser);
      560 |
    > 561 |       await guard.user();
          |                   ^
      562 |
      563 |       expect(mockProvider.retrieveByCredentials).toHaveBeenCalledWith({
      564 |         stored_token: 'my-token'

      at Object.<anonymous> (tests/unit/Auth/TokenGuard.test.js:561:19)

FAIL tests/unit/Auth/ModelUserProvider.test.js
  ● ModelUserProvider › Retrieve By ID › should retrieve user by id

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:132:35)

  ● ModelUserProvider › Retrieve By ID › should return null for non-existent user

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:140:35)

  ● ModelUserProvider › Retrieve By ID › should use getAuthIdentifierName if available

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:146:35)

  ● ModelUserProvider › Retrieve By Token › should retrieve user by id and token

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:154:35)

  ● ModelUserProvider › Retrieve By Token › should return null if user not found

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:162:35)

  ● ModelUserProvider › Retrieve By Token › should return null if token does not match

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:168:35)

  ● ModelUserProvider › Retrieve By Token › should handle user without getRememberToken method

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:180:35)

  ● ModelUserProvider › Edge Cases › should handle model without getAuthIdentifierName

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:426:35)

  ● ModelUserProvider › Edge Cases › should handle user with null remember_token

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      25 |   async retrieveByToken(identifier, token) {
      26 |     const Model = this.createModel();
    > 27 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      28 |     
      29 |     const user = await Model.where(authIdentifierName, identifier).first();
      30 |

      at ModelUserProvider.retrieveByToken (framework/Auth/UserProviders/ModelUserProvider.js:27:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:519:35)

  ● ModelUserProvider › Edge Cases › should handle async model methods

    TypeError: Cannot read properties of undefined (reading 'getAuthIdentifierName')

      15 |   async retrieveById(identifier) {
      16 |     const Model = this.createModel();
    > 17 |     const authIdentifierName = Model.prototype.getAuthIdentifierName?.() || 'id';
         |                                                ^
      18 |     
      19 |     return await Model.where(authIdentifierName, identifier).first();
      20 |   }

      at ModelUserProvider.retrieveById (framework/Auth/UserProviders/ModelUserProvider.js:17:48)
      at Object.<anonymous> (tests/unit/Auth/ModelUserProvider.test.js:575:35)

FAIL tests/unit/client-config-generator.test.js
  ● ClientConfigGenerator › generate() › should generate basic configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should generate basic configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include app configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include app configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include API configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include API configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include auth configuration without secrets

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include auth configuration without secrets

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include feature flags

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include feature flags

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include upload configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include upload configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include branding configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include branding configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should include formatting configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should include formatting configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should merge custom configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should merge custom configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should apply overrides

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should apply overrides

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should expose additional config keys

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should expose additional config keys

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should exclude specified keys

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should exclude specified keys

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generate() › should not expose excluded keys even if in expose list

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generate() › should not expose excluded keys even if in expose list

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generatePublic() › should generate minimal public configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generatePublic() › should generate minimal public configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generatePublic() › should include only public fields

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generatePublic() › should include only public fields

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generatePublic() › should include minimal auth info

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generatePublic() › should include minimal auth info

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generateForUser() › should generate user-specific configuration

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generateForUser() › should generate user-specific configuration

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › generateForUser() › should include base config with user config

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › generateForUser() › should include base config with user config

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should merge nested objects

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should merge nested objects

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should override primitive values

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deepMerge() › should override primitive values

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should set nested value using dot notation

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should set nested value using dot notation

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should override existing values

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _setNestedValue() › should override existing values

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should delete nested value using dot notation

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should delete nested value using dot notation

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should handle non-existent paths gracefully

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _deleteNestedValue() › should handle non-existent paths gracefully

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return true for plain objects

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return true for plain objects

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for arrays

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for arrays

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for primitives

    ReferenceError: jest is not defined

      15 |     
      16 |     // Mock Config.get
    > 17 |     jest.spyOn(Config, 'get').mockImplementation((key, defaultValue) => {
         |     ^
      18 |       const mockConfig = {
      19 |         'app.name': 'Test App',
      20 |         'app.env': 'testing',

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:17:5)

  ● ClientConfigGenerator › Helper methods › _isObject() › should return false for primitives

    ReferenceError: jest is not defined

      68 |
      69 |   afterEach(() => {
    > 70 |     jest.restoreAllMocks();
         |     ^
      71 |   });
      72 |
      73 |   describe('generate()', () => {

      at Object.<anonymous> (tests/unit/client-config-generator.test.js:70:5)

FAIL tests/unit/import-aliases.test.js
  ● Unit: Import Alias Patterns › #framework/* alias pattern › should fail without .js extension

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      43 |
      44 |     test('should fail without .js extension', async () => {
    > 45 |       await expect(async () => {
         |             ^
      46 |         await import('#framework/Services/Cache/CacheManager');
      47 |       }).rejects.toThrow();
      48 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:45:13)

  ● Unit: Import Alias Patterns › #models/* alias pattern › models should extend base Model class

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      87 |
      88 |     test('models should extend base Model class', async () => {
    > 89 |       const Model = await import('vasuzex/Database/Model.js');
         |                     ^
      90 |       const { User } = await import('#models/User.js');
      91 |       
      92 |       expect(User.prototype).toBeInstanceOf(Model.default);

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:89:21)

  ● Unit: Import Alias Patterns › vasuzex/* alias pattern (via jest) › should import from subpaths

    Cannot find module 'vasuzex/Foundation/Application.js' from 'tests/unit/import-aliases.test.js'

      146 |
      147 |     test('should import from subpaths', async () => {
    > 148 |       const { Application } = await import('vasuzex/Foundation/Application.js');
          |                               ^
      149 |       const Model = await import('vasuzex/Database/Model.js');
      150 |       const { Collection } = await import('vasuzex/Support/Collection.js');
      151 |       

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:148:31)

  ● Unit: Import Alias Patterns › vasuzex/* alias pattern (via jest) › should import support utilities

    Cannot find module 'vasuzex/Support/Str.js' from 'tests/unit/import-aliases.test.js'

      156 |
      157 |     test('should import support utilities', async () => {
    > 158 |       const { Str } = await import('vasuzex/Support/Str.js');
          |                       ^
      159 |       const { Arr } = await import('vasuzex/Support/Arr.js');
      160 |       
      161 |       expect(typeof Str.slug).toBe('function');

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:158:23)

  ● Unit: Import Alias Patterns › vasuzex/* alias pattern (via jest) › should import facades individually

    Cannot find module 'vasuzex/Support/Facades/DB.js' from 'tests/unit/import-aliases.test.js'

      166 |
      167 |     test('should import facades individually', async () => {
    > 168 |       const { DB } = await import('vasuzex/Support/Facades/DB.js');
          |                      ^
      169 |       const { Cache } = await import('vasuzex/Support/Facades/Cache.js');
      170 |       const { Auth } = await import('vasuzex/Support/Facades/Auth.js');
      171 |       

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:168:22)

  ● Unit: Import Alias Patterns › Dynamic imports › should support lazy loading

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      265 |       
      266 |       const loadModel = async () => {
    > 267 |         Model = await import('vasuzex/Database/Model.js');
          |                 ^
      268 |       };
      269 |       
      270 |       await loadModel();

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at loadModel (tests/unit/import-aliases.test.js:267:17)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:270:7)

  ● Unit: Import Alias Patterns › Error handling › should throw on missing file extension for #framework

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      281 |
      282 |     test('should throw on missing file extension for #framework', async () => {
    > 283 |       await expect(async () => {
          |             ^
      284 |         await import('#framework/Services/Cache/CacheManager');
      285 |       }).rejects.toThrow();
      286 |     });

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:283:13)

  ● Unit: Import Alias Patterns › Error handling › should handle import errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: "ERR_MODULE_NOT_FOUND"
    Received: "MODULE_NOT_FOUND"

      291 |       } catch (error) {
      292 |         expect(error).toBeDefined();
    > 293 |         expect(error.code).toBe('ERR_MODULE_NOT_FOUND');
          |                            ^
      294 |       }
      295 |     });
      296 |   });

      at Object.<anonymous> (tests/unit/import-aliases.test.js:293:28)

  ● Unit: Import Alias Patterns › Type consistency › should maintain class inheritance

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      420 |
      421 |     test('should maintain class inheritance', async () => {
    > 422 |       const Model = await import('vasuzex/Database/Model.js');
          |                     ^
      423 |       const { User } = await import('#models/User.js');
      424 |       
      425 |       const user = new User();

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:422:21)

  ● Unit: Import Alias Patterns › Type consistency › should maintain prototype chain

    Cannot find module 'vasuzex/Database/Model.js' from 'tests/unit/import-aliases.test.js'

      429 |
      430 |     test('should maintain prototype chain', async () => {
    > 431 |       const Model = await import('vasuzex/Database/Model.js');
          |                     ^
      432 |       const { Post } = await import('#models/Post.js');
      433 |       
      434 |       expect(Object.getPrototypeOf(Post)).toBe(Model.default);

      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/resolver.js:427:11)
      at Object.<anonymous> (tests/unit/import-aliases.test.js:431:21)


Test Suites: 5 failed, 58 passed, 63 total
Tests:       72 failed, 2082 passed, 2154 total
Snapshots:   0 total
Time:        8.255 s
Ran all test suites matching /tests\/unit/i.
 ELIFECYCLE  Command failed with exit code 1.
