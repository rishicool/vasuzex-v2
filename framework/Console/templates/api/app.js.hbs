/**
 * {{pascalCase appName}} API Application
 * Extends BaseApp from framework for clean architecture
 */

import { BaseApp } from 'vasuzex';
import { HashServiceProvider } from 'vasuzex/Foundation/Providers/HashServiceProvider';
import { env } from './helpers/env.js';
import { errorHandler, notFoundHandler } from './middleware/errorHandler.js';
import { getAllRoutes } from './routes/index.js';

/**
 * {{pascalCase appName}}App - Extends BaseApp
 * Organized and maintainable Express app configuration
 */
class {{pascalCase appName}}App extends BaseApp {
  constructor(projectRoot) {
    super({
      serviceName: process.env.APP_NAME || '{{appName}}-api',
      corsOrigin: env('CORS_ORIGIN', '*'),
      projectRoot: projectRoot
    });
    
    // Register service providers
    this.registerServiceProviders();
  }
  
  /**
   * Register service providers
   */
  registerServiceProviders() {
    // Register Hash service for password hashing
    this.register(HashServiceProvider);
  }

  /**
   * Setup custom middleware (after body parsers, before routes)
   */
  setupCustomMiddleware() {
    // Add your custom middleware here
    // Example: app.use(requestLogger());
  }

  /**
   * Setup API routes
   */
  setupRoutes() {
    const routes = getAllRoutes();
    routes.forEach(({ path, router, handler }) => {
      if (handler) {
        this.express.get(path, handler);
      } else if (router) {
        this.registerRoute(path, router);
      }
    });
  }

  /**
   * Get error handlers
   */
  getErrorHandlers() {
    return { errorHandler, notFoundHandler };
  }
}

/**
 * Create and configure the Express app
 */
export function createApp(projectRoot) {
  const app = new {{pascalCase appName}}App(projectRoot);
  return app;
}
